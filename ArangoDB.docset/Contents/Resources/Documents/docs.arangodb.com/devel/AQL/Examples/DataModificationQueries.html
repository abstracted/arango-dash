<!DOCTYPE HTML>
<html lang="en" >
    <!-- Start book ArangoDB v3.0.x-devel (2016-06-02) AQL Documentation -->
    <head>
        <!-- head:start -->
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>Data-modification queries | ArangoDB v3.0.x-devel (2016-06-02) AQL Documentation</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.6.7">
        <meta name="author" content="ArangoDB GmbH">
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">
        
    <link rel="stylesheet" href="../gitbook/style.css">
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-toggle-chapters/toggle.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-highlight/website.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-fontsettings/website.css">
        
    
    
        <link rel="stylesheet" href="../styles/website.css">
    

        
    
    
    <link rel="next" href="../Examples/CombiningQueries.html" />
    
    
    <link rel="prev" href="../Examples/Counting.html" />
    

        <!-- head:end -->
<script type="text/javascript" src="../styles/header.js"></script><link rel="stylesheet" type="text/css" href="../styles/header.css">
    </head>
    <body>
        <!-- body:start -->
<div id="header">
  <div id="logo">
    <a href="https://arangodb.com/">
      <img src="https://docs.arangodb.com/assets/arangodb_logo_2016.png">
    </a>
  </div>
  <div id="logo-small">
    <a href="https://arangodb.com/">
      <img src="https://docs.arangodb.com/assets/arangodb_logo_small_2016.png">
    </a>
  </div>
  <select id="version-switcher">
    <option value="devel">v3.0.x-devel (2016-06-02)</option>
    <option value="2.8">v2.8</option>
    <option value="2.7">v2.7</option>
    <option value="2.6">v2.6</option>
    <option value="2.5">v2.5</option>
    <option value="2.4">v2.4</option>
    <option value="2.3">v2.3</option>
    <option value="2.2">v2.2</option>
    <option value="2.1">v2.1</option>
  </select>
  <div class="google-search">
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
  <ul id="navmenu">
    <li>
      <a href="https://docs.arangodb.com/devel/Manual/index.html">Manual</a>
    </li>
    <li class="active-tab">
      <a href="https://docs.arangodb.com/devel/AQL/index.html">AQL</a>
    </li>
    <li>
      <a href="https://docs.arangodb.com/devel/HTTP/index.html">HTTP</a>
    </li>
    <li>
      <a href="https://docs.arangodb.com/cookbook">Cookbook</a>
    </li>
    <li class="socialIcons">
      <a href="https://github.com/ArangoDB/ArangoDB/issues" target="blank" name="github">
        <i title="GitHub" class="fa fa-github"></i>
      </a>
    </li>
    <li class="socialIcons">
      <a href="http://stackoverflow.com/questions/tagged/arangodb" target="blank" name="stackoverflow">
        <i title="Stackoverflow" class="fa fa-stack-overflow"></i>
      </a>
    </li>
    <li class="socialIcons socialIcons-googlegroups">
      <a href="https://groups.google.com/forum/#!forum/arangodb" target="blank" name="google groups">
        <img title="Google Groups" alt="Google Groups" src="https://docs.arangodb.com/assets/googlegroupsIcon.png" />
      </a>
    </li>
  </ul>
</div>
        
    <div class="book"
        data-level="9.2"
        data-chapter-title="Data-modification queries"
        data-filepath="Examples/DataModificationQueries.md"
        data-basepath=".."
        data-revision="Thu Jun 02 2016 11:44:53 GMT+0000 (UTC)"
        data-innerlanguage="">
    

<div class="book-summary">
    <nav role="navigation">
        <ul class="summary">
            
            
            
            

            

            
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="../index.html">
                
                        <i class="fa fa-check"></i>
                        
                        Introduction
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1" data-path="Invocation/index.html">
            
                
                    <a href="../Invocation/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                        How to invoke AQL
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1" data-path="Invocation/WithArangosh.html">
            
                
                    <a href="../Invocation/WithArangosh.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.</b>
                        
                        with Arangosh
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="Invocation/WithWebInterface.html">
            
                
                    <a href="../Invocation/WithWebInterface.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.2.</b>
                        
                        with the Web Interface
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2" data-path="Fundamentals/index.html">
            
                
                    <a href="../Fundamentals/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                        AQL Fundamentals
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1" data-path="Fundamentals/Syntax.html">
            
                
                    <a href="../Fundamentals/Syntax.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.</b>
                        
                        AQL Syntax
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="Fundamentals/DataTypes.html">
            
                
                    <a href="../Fundamentals/DataTypes.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.2.</b>
                        
                        Data types
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="Fundamentals/BindParameters.html">
            
                
                    <a href="../Fundamentals/BindParameters.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.3.</b>
                        
                        Bind Parameters
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="Fundamentals/TypeValueOrder.html">
            
                
                    <a href="../Fundamentals/TypeValueOrder.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.4.</b>
                        
                        Type and value order
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.5" data-path="Fundamentals/DocumentData.html">
            
                
                    <a href="../Fundamentals/DocumentData.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.5.</b>
                        
                        Accessing data from collections
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.6" data-path="Fundamentals/QueryResults.html">
            
                
                    <a href="../Fundamentals/QueryResults.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.6.</b>
                        
                        Query Results
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.7" data-path="Fundamentals/QueryErrors.html">
            
                
                    <a href="../Fundamentals/QueryErrors.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.7.</b>
                        
                        Query Errors
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3" data-path="Operators.html">
            
                
                    <a href="../Operators.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                        Operators
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4" data-path="DataModification.html">
            
                
                    <a href="../DataModification.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.</b>
                        
                        Data Modification Queries
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5" data-path="Operations/index.html">
            
                
                    <a href="../Operations/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.</b>
                        
                        High level Operations
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1" data-path="Operations/For.html">
            
                
                    <a href="../Operations/For.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.1.</b>
                        
                        FOR
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.2" data-path="Operations/Return.html">
            
                
                    <a href="../Operations/Return.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.2.</b>
                        
                        RETURN
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.3" data-path="Operations/Filter.html">
            
                
                    <a href="../Operations/Filter.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.3.</b>
                        
                        FILTER
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.4" data-path="Operations/Sort.html">
            
                
                    <a href="../Operations/Sort.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.4.</b>
                        
                        SORT
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.5" data-path="Operations/Limit.html">
            
                
                    <a href="../Operations/Limit.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.5.</b>
                        
                        LIMIT
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.6" data-path="Operations/Let.html">
            
                
                    <a href="../Operations/Let.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.6.</b>
                        
                        LET
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.7" data-path="Operations/Collect.html">
            
                
                    <a href="../Operations/Collect.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.7.</b>
                        
                        COLLECT
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.8" data-path="Operations/Remove.html">
            
                
                    <a href="../Operations/Remove.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.8.</b>
                        
                        REMOVE
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.9" data-path="Operations/Update.html">
            
                
                    <a href="../Operations/Update.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.9.</b>
                        
                        UPDATE
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.10" data-path="Operations/Replace.html">
            
                
                    <a href="../Operations/Replace.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.10.</b>
                        
                        REPLACE
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.11" data-path="Operations/Insert.html">
            
                
                    <a href="../Operations/Insert.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.11.</b>
                        
                        INSERT
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.12" data-path="Operations/Upsert.html">
            
                
                    <a href="../Operations/Upsert.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.12.</b>
                        
                        UPSERT
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="6" data-path="Functions/index.html">
            
                
                    <a href="../Functions/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.</b>
                        
                        Functions
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="6.1" data-path="Functions/TypeCast.html">
            
                
                    <a href="../Functions/TypeCast.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.1.</b>
                        
                        Type cast
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.2" data-path="Functions/String.html">
            
                
                    <a href="../Functions/String.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.2.</b>
                        
                        String
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.3" data-path="Functions/Numeric.html">
            
                
                    <a href="../Functions/Numeric.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.3.</b>
                        
                        Numeric
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.4" data-path="Functions/Date.html">
            
                
                    <a href="../Functions/Date.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.4.</b>
                        
                        Date
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.5" data-path="Functions/Array.html">
            
                
                    <a href="../Functions/Array.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.5.</b>
                        
                        Array
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.6" data-path="Functions/Document.html">
            
                
                    <a href="../Functions/Document.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.6.</b>
                        
                        Object / Document
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.7" data-path="Functions/Geo.html">
            
                
                    <a href="../Functions/Geo.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.7.</b>
                        
                        Geo
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.8" data-path="Functions/Fulltext.html">
            
                
                    <a href="../Functions/Fulltext.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.8.</b>
                        
                        Fulltext
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.9" data-path="Functions/Miscellaneous.html">
            
                
                    <a href="../Functions/Miscellaneous.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.9.</b>
                        
                        Miscellaneous
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="7" data-path="Graphs/index.html">
            
                
                    <a href="../Graphs/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.</b>
                        
                        Graphs
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="7.1" data-path="Graphs/Traversals.html">
            
                
                    <a href="../Graphs/Traversals.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.1.</b>
                        
                        Traversal
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="7.2" data-path="Graphs/Operations.html">
            
                
                    <a href="../Graphs/Operations.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.2.</b>
                        
                        Named Operations
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="7.3" data-path="Graphs/Functions.html">
            
                
                    <a href="../Graphs/Functions.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.3.</b>
                        
                        Other
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="8" data-path="Advanced/index.html">
            
                
                    <a href="../Advanced/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.</b>
                        
                        Advanced Features
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="8.1" data-path="Advanced/ArrayOperators.html">
            
                
                    <a href="../Advanced/ArrayOperators.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.1.</b>
                        
                        Array Operators
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="9" data-path="Examples/index.html">
            
                
                    <a href="../Examples/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.</b>
                        
                        Usual Query Patterns
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="9.1" data-path="Examples/Counting.html">
            
                
                    <a href="../Examples/Counting.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.1.</b>
                        
                        Counting
                    </a>
            
            
        </li>
    
        <li class="chapter active" data-level="9.2" data-path="Examples/DataModificationQueries.html">
            
                
                    <a href="../Examples/DataModificationQueries.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.2.</b>
                        
                        Data-modification queries
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="9.3" data-path="Examples/CombiningQueries.html">
            
                
                    <a href="../Examples/CombiningQueries.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.3.</b>
                        
                        Subqueries
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="9.4" data-path="Examples/ProjectionsAndFilters.html">
            
                
                    <a href="../Examples/ProjectionsAndFilters.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.4.</b>
                        
                        Projections and filters
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="9.5" data-path="Examples/Join.html">
            
                
                    <a href="../Examples/Join.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.5.</b>
                        
                        Joins
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="9.6" data-path="Examples/Grouping.html">
            
                
                    <a href="../Examples/Grouping.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.6.</b>
                        
                        Grouping
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="9.7" data-path="Examples/CombiningGraphTraversals.html">
            
                
                    <a href="../Examples/CombiningGraphTraversals.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.7.</b>
                        
                        Traversals
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="9.8" data-path="Examples/QueriesNoCollections.html">
            
                
                    <a href="../Examples/QueriesNoCollections.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.8.</b>
                        
                        Queries without collections
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="10" data-path="Extending/index.html">
            
                
                    <a href="../Extending/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>10.</b>
                        
                        User Functions
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="10.1" data-path="Extending/Conventions.html">
            
                
                    <a href="../Extending/Conventions.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>10.1.</b>
                        
                        Conventions
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="10.2" data-path="Extending/Functions.html">
            
                
                    <a href="../Extending/Functions.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>10.2.</b>
                        
                        Registering Functions
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="11" data-path="ExecutionAndPerformance/index.html">
            
                
                    <a href="../ExecutionAndPerformance/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>11.</b>
                        
                        Execution and Performance
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="11.1" data-path="ExecutionAndPerformance/QueryStatistics.html">
            
                
                    <a href="../ExecutionAndPerformance/QueryStatistics.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>11.1.</b>
                        
                        Query statistics
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="11.2" data-path="ExecutionAndPerformance/ParsingQueries.html">
            
                
                    <a href="../ExecutionAndPerformance/ParsingQueries.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>11.2.</b>
                        
                        Parsing queries
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="11.3" data-path="ExecutionAndPerformance/ExplainingQueries.html">
            
                
                    <a href="../ExecutionAndPerformance/ExplainingQueries.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>11.3.</b>
                        
                        Explaining queries
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="11.4" data-path="ExecutionAndPerformance/Optimizer.html">
            
                
                    <a href="../ExecutionAndPerformance/Optimizer.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>11.4.</b>
                        
                        Optimizing queries
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="11.5" data-path="ExecutionAndPerformance/QueryCache.html">
            
                
                    <a href="../ExecutionAndPerformance/QueryCache.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>11.5.</b>
                        
                        Caching query results
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="12" data-path="CommonErrors.html">
            
                
                    <a href="../CommonErrors.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>12.</b>
                        
                        Common Errors
                    </a>
            
            
        </li>
    


            
            <li class="divider"></li>
            <li>
                <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                    Published with GitBook
                </a>
            </li>
            
        </ul>
    </nav>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header" role="navigation">
    <!-- Actions Left -->
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../" >ArangoDB v3.0.x-devel (2016-06-02) AQL Documentation</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1" role="main">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <p><a name="data-modification_queries"></a></p>
<h1 id="datamodification-queries">Data-modification queries</h1>
<p>The following operations can be used to modify data of multiple documents
with one query. This is superior to fetching and updating the documents individually
with multiple queries. However, if only a single document needs to be modified,
ArangoDB&apos;s specialized data-modification operations for single documents
might execute faster.</p>
<p><a name="updating_documents"></a></p>
<h2 id="updating-documents">Updating documents</h2>
<p>To update existing documents, we can either use the <em>UPDATE</em> or the <em>REPLACE</em>
operation. <em>UPDATE</em> updates only the specified attributes in the found documents,
and <em>REPLACE</em> completely replaces the found documents with the specified values.</p>
<p>We&apos;ll start with an <em>UPDATE</em> query that rewrites the gender attribute in all
documents:</p>
<pre><code class="lang-js">FOR u IN users
  UPDATE u WITH { gender: TRANSLATE(u.gender, { m: <span class="hljs-string">&apos;male&apos;</span>, f: <span class="hljs-string">&apos;female&apos;</span> }) } IN users
</code></pre>
<p>To add new attributes to existing documents, we can also use an <em>UPDATE</em> query.
The following query adds an attribute <em>numberOfLogins</em> for all users with status
active:</p>
<pre><code class="lang-js">FOR u IN users
  FILTER u.active == <span class="hljs-literal">true</span>
  UPDATE u WITH { numberOfLogins: <span class="hljs-number">0</span> } IN users
</code></pre>
<p>Existing attributes can also be updated based on their previous value:</p>
<pre><code class="lang-js">FOR u IN users
  FILTER u.active == <span class="hljs-literal">true</span>
  UPDATE u WITH { numberOfLogins: u.numberOfLogins + <span class="hljs-number">1</span> } IN users
</code></pre>
<p>The above query will only work if there was already a <em>numberOfLogins</em> attribute
present in the document. If it is unsure whether there is a <em>numberOfLogins</em>
attribute in the document, the increase must be made conditional:</p>
<pre><code class="lang-js">FOR u IN users
  FILTER u.active == <span class="hljs-literal">true</span>
  UPDATE u WITH {
    numberOfLogins: HAS(u, <span class="hljs-string">&apos;numberOfLogins&apos;</span>) ? u.numberOfLogins + <span class="hljs-number">1</span> : <span class="hljs-number">1</span>
  } IN users
</code></pre>
<p>Updates of multiple attributes can be combined in a single query:</p>
<pre><code class="lang-js">FOR u IN users
  FILTER u.active == <span class="hljs-literal">true</span>
  UPDATE u WITH {
    lastLogin: DATE_NOW(),
    numberOfLogins: HAS(u, <span class="hljs-string">&apos;numberOfLogins&apos;</span>) ? u.numberOfLogins + <span class="hljs-number">1</span> : <span class="hljs-number">1</span>
  } IN users
</code></pre>
<p>Note than an update query might fail during execution, for example because a
document to be updated does not exist. In this case, the query will abort at
the first error. In single-server mode, all modifications done by the query will
be rolled back as if they never happened.</p>
<p><a name="replacing_documents"></a></p>
<h2 id="replacing-documents">Replacing documents</h2>
<p>To not just partially update, but completely replace existing documents, use
the <em>REPLACE</em> operation.
The following query replaces all documents in the collection backup with
the documents found in collection users. Documents common to both
collections will be replaced. All other documents will remain unchanged.
Documents are compared using their <em>_key</em> attributes:</p>
<pre><code class="lang-js">FOR u IN users
  REPLACE u IN backup
</code></pre>
<p>The above query will fail if there are documents in collection users that are
not in collection backup yet. In this case, the query would attempt to replace
documents that do not exist. If such case is detected while executing the query,
the query will abort. In single-server mode, all changes made by the query will
also be rolled back.</p>
<p>To make the query succeed for such case, use the <em>ignoreErrors</em> query option:</p>
<pre><code class="lang-js">FOR u IN users
  REPLACE u IN backup OPTIONS { ignoreErrors: <span class="hljs-literal">true</span> }
</code></pre>
<p><a name="removing_documents"></a></p>
<h2 id="removing-documents">Removing documents</h2>
<p>Deleting documents can be achieved with the <em>REMOVE</em> operation.
To remove all users within a certain age range, we can use the following query:</p>
<pre><code class="lang-js">FOR u IN users
  FILTER u.active == <span class="hljs-literal">true</span> &amp;&amp; u.age &gt;= <span class="hljs-number">35</span> &amp;&amp; u.age &lt;= <span class="hljs-number">37</span>
  REMOVE u IN users
</code></pre>
<p><a name="creating_documents"></a></p>
<h2 id="creating-documents">Creating documents</h2>
<p>To create new documents, there is the <em>INSERT</em> operation.
It can also be used to generate copies of existing documents from other collections,
or to create synthetic documents (e.g. for testing purposes). The following
query creates 1000 test users in collection users with some attributes set:</p>
<pre><code class="lang-js">FOR i IN <span class="hljs-number">1.</span><span class="hljs-number">.1000</span>
  INSERT {
    id: <span class="hljs-number">100000</span> + i,
    age: <span class="hljs-number">18</span> + FLOOR(RAND() * <span class="hljs-number">25</span>),
    name: CONCAT(<span class="hljs-string">&apos;test&apos;</span>, TO_STRING(i)),
    active: <span class="hljs-literal">false</span>,
    gender: i % <span class="hljs-number">2</span> == <span class="hljs-number">0</span> ? <span class="hljs-string">&apos;male&apos;</span> : <span class="hljs-string">&apos;female&apos;</span>
  } IN users
</code></pre>
<p><a name="copying_data_from_one_collection_into_another"></a></p>
<h2 id="copying-data-from-one-collection-into-another">Copying data from one collection into another</h2>
<p>To copy data from one collection into another, an <em>INSERT</em> operation can be
used:</p>
<pre><code class="lang-js">FOR u IN users
  INSERT u IN backup
</code></pre>
<p>This will copy over all documents from collection users into collection
backup. Note that both collections must already exist when the query is
executed. The query might fail if backup already contains documents, as
executing the insert might attempt to insert the same document (identified
by <em>_key</em> attribute) again. This will trigger a unique key constraint violation
and abort the query. In single-server mode, all changes made by the query
will also be rolled back.
To make such copy operation work in all cases, the target collection can
be emptied before, using a <em>REMOVE</em> query.</p>
<p><a name="handling_errors"></a></p>
<h2 id="handling-errors">Handling errors</h2>
<p>In some cases it might be desirable to continue execution of a query even in
the face of errors (e.g. &quot;document not found&quot;). To continue execution of a
query in case of errors, there is the <em>ignoreErrors</em> option.</p>
<p>To use it, place an <em>OPTIONS</em> keyword directly after the data modification
part of the query, e.g.</p>
<pre><code class="lang-js">FOR u IN users
  REPLACE u IN backup OPTIONS { ignoreErrors: <span class="hljs-literal">true</span> }
</code></pre>
<p>This will continue execution of the query even if errors occur during the
<em>REPLACE</em> operation. It works similar for <em>UPDATE</em>, <em>INSERT</em>, and <em>REMOVE</em>.</p>
<p><a name="altering_substructures"></a></p>
<h2 id="altering-substructures">Altering substructures</h2>
<p>To modify lists in documents we have to work with temporary variables.
We will collect the sublist in there and alter it. We choose a simple
boolean filter condition to make the query better comprehensible.</p>
<p>First lets create a collection with a sample:</p>
<pre><code class="lang-js">database = db._create(<span class="hljs-string">&apos;complexCollection&apos;</span>)
database.save({
  <span class="hljs-string">&quot;topLevelAttribute&quot;</span> : <span class="hljs-string">&quot;a&quot;</span>,
  <span class="hljs-string">&quot;subList&quot;</span> : [
    {
      <span class="hljs-string">&quot;attributeToAlter&quot;</span> : <span class="hljs-string">&quot;oldValue&quot;</span>,
      <span class="hljs-string">&quot;filterByMe&quot;</span> : <span class="hljs-literal">true</span>
    },
    {
      <span class="hljs-string">&quot;attributeToAlter&quot;</span> : <span class="hljs-string">&quot;moreOldValues&quot;</span>,
      <span class="hljs-string">&quot;filterByMe&quot;</span> : <span class="hljs-literal">true</span>
    },
    {
      <span class="hljs-string">&quot;attributeToAlter&quot;</span> : <span class="hljs-string">&quot;unchangedValue&quot;</span>,
      <span class="hljs-string">&quot;filterByMe&quot;</span> : <span class="hljs-literal">false</span>
    }
  ]
})
</code></pre>
<p>Heres the Query which keeps the <em>subList</em> on <em>alteredList</em> to update it later:</p>
<pre><code class="lang-js">FOR <span class="hljs-built_in">document</span> <span class="hljs-keyword">in</span> complexCollection
  LET alteredList = (
    FOR element IN <span class="hljs-built_in">document</span>.subList
       LET newItem = (! element.filterByMe ?
                      element :
                      MERGE(element, { attributeToAlter: <span class="hljs-string">&quot;shiny New Value&quot;</span> }))
       RETURN newItem)
  UPDATE <span class="hljs-built_in">document</span> WITH { subList:  alteredList } IN complexCollection
</code></pre>
<p>While the query as it is is now functional:</p>
<pre><code class="lang-js">db.complexCollection.toArray()
[
  {
    <span class="hljs-string">&quot;_id&quot;</span> : <span class="hljs-string">&quot;complexCollection/392671569467&quot;</span>,
    <span class="hljs-string">&quot;_key&quot;</span> : <span class="hljs-string">&quot;392671569467&quot;</span>,
    <span class="hljs-string">&quot;_rev&quot;</span> : <span class="hljs-string">&quot;392799430203&quot;</span>,
    <span class="hljs-string">&quot;topLevelAttribute&quot;</span> : <span class="hljs-string">&quot;a&quot;</span>,
    <span class="hljs-string">&quot;subList&quot;</span> : [
      {
        <span class="hljs-string">&quot;filterByMe&quot;</span> : <span class="hljs-literal">true</span>,
        <span class="hljs-string">&quot;attributeToAlter&quot;</span> : <span class="hljs-string">&quot;shiny New Value&quot;</span>
      },
      {
        <span class="hljs-string">&quot;filterByMe&quot;</span> : <span class="hljs-literal">true</span>,
        <span class="hljs-string">&quot;attributeToAlter&quot;</span> : <span class="hljs-string">&quot;shiny New Value&quot;</span>
      },
      {
        <span class="hljs-string">&quot;filterByMe&quot;</span> : <span class="hljs-literal">false</span>,
        <span class="hljs-string">&quot;attributeToAlter&quot;</span> : <span class="hljs-string">&quot;unchangedValue&quot;</span>
      }
    ]
  }
]
</code></pre>
<p>It will probably be soonish a performance bottleneck, since it <strong>modifies</strong>
all documents in the collection <strong>regardless whether the values change or not</strong>.
Therefore we want to only <em>UPDATE</em> the documents if we really change their value.
Hence we employ a second <em>FOR</em> to test whether <em>subList</em> will be altered or not:</p>
<pre><code class="lang-js">FOR <span class="hljs-built_in">document</span> <span class="hljs-keyword">in</span> complexCollection
  LET willUpdateDocument = (
    FOR element IN docToAlter.subList
      FILTER element.filterByMe LIMIT <span class="hljs-number">1</span> RETURN <span class="hljs-number">1</span>)

  FILTER LENGTH(willUpdateDocument) &gt; <span class="hljs-number">0</span>

  LET alteredList = (
    FOR element IN <span class="hljs-built_in">document</span>.subList
       LET newItem = (! element.filterByMe ?
                      element :
                      MERGE(element, { attributeToAlter: <span class="hljs-string">&quot;shiny New Value&quot;</span> }))
       RETURN newItem)

  UPDATE <span class="hljs-built_in">document</span> WITH { subList:  alteredList } IN complexCollection
</code></pre>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="../Examples/Counting.html" class="navigation navigation-prev " aria-label="Previous page: Counting"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="../Examples/CombiningQueries.html" class="navigation navigation-next " aria-label="Next page: Subqueries"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="../gitbook/app.js"></script>

    
    <script src="../gitbook/plugins/gitbook-plugin-toggle-chapters/toggle.js"></script>
    

    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/3.1.1/anchor.min.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-anchorjs/anchor-style.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-piwik/plugin.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-fontsettings/buttons.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"addcssjs":{"js":["styles/header.js"],"css":["styles/header.css"]},"add-header":{"BASE_PATH":"https://docs.arangodb.com/devel"},"piwik":{"URL":"www.arangodb.com/piwik/","siteId":12},"toggle-chapters":{},"anchorjs":{},"highlight":{},"fontsettings":{"theme":"white","family":"sans","size":2}};
    gitbook.start(config);
});
</script>

        <!-- body:end -->
<script type="text/javascript">var _paq = _paq || [];_paq.push(['trackPageView']);_paq.push(['enableLinkTracking']);(function() {var u=(("https:" == document.location.protocol) ? "https" : "http") + "://www.arangodb.com/piwik/";_paq.push(['setTrackerUrl', u+'piwik.php']);_paq.push(['setSiteId', 12]);var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0]; g.type='text/javascript';g.defer=true; g.async=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);})();</script><noscript><p><img src="http://www.arangodb.com/piwik/piwik.php?idsite=12" style="border:0;" alt="" /></p></noscript>
    </body>
    <!-- End of book ArangoDB v3.0.x-devel (2016-06-02) AQL Documentation -->
</html>
