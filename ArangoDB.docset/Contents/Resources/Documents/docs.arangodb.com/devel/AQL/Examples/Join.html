<!DOCTYPE HTML>
<html lang="en" >
    <!-- Start book ArangoDB v3.0.x-devel (2016-06-02) AQL Documentation -->
    <head>
        <!-- head:start -->
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>Joins | ArangoDB v3.0.x-devel (2016-06-02) AQL Documentation</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.6.7">
        <meta name="author" content="ArangoDB GmbH">
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">
        
    <link rel="stylesheet" href="../gitbook/style.css">
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-toggle-chapters/toggle.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-highlight/website.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-fontsettings/website.css">
        
    
    
        <link rel="stylesheet" href="../styles/website.css">
    

        
    
    
    <link rel="next" href="../Examples/Grouping.html" />
    
    
    <link rel="prev" href="../Examples/ProjectionsAndFilters.html" />
    

        <!-- head:end -->
<script type="text/javascript" src="../styles/header.js"></script><link rel="stylesheet" type="text/css" href="../styles/header.css">
    </head>
    <body>
        <!-- body:start -->
<div id="header">
  <div id="logo">
    <a href="https://arangodb.com/">
      <img src="https://docs.arangodb.com/assets/arangodb_logo_2016.png">
    </a>
  </div>
  <div id="logo-small">
    <a href="https://arangodb.com/">
      <img src="https://docs.arangodb.com/assets/arangodb_logo_small_2016.png">
    </a>
  </div>
  <select id="version-switcher">
    <option value="devel">v3.0.x-devel (2016-06-02)</option>
    <option value="2.8">v2.8</option>
    <option value="2.7">v2.7</option>
    <option value="2.6">v2.6</option>
    <option value="2.5">v2.5</option>
    <option value="2.4">v2.4</option>
    <option value="2.3">v2.3</option>
    <option value="2.2">v2.2</option>
    <option value="2.1">v2.1</option>
  </select>
  <div class="google-search">
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
  <ul id="navmenu">
    <li>
      <a href="https://docs.arangodb.com/devel/Manual/index.html">Manual</a>
    </li>
    <li class="active-tab">
      <a href="https://docs.arangodb.com/devel/AQL/index.html">AQL</a>
    </li>
    <li>
      <a href="https://docs.arangodb.com/devel/HTTP/index.html">HTTP</a>
    </li>
    <li>
      <a href="https://docs.arangodb.com/cookbook">Cookbook</a>
    </li>
    <li class="socialIcons">
      <a href="https://github.com/ArangoDB/ArangoDB/issues" target="blank" name="github">
        <i title="GitHub" class="fa fa-github"></i>
      </a>
    </li>
    <li class="socialIcons">
      <a href="http://stackoverflow.com/questions/tagged/arangodb" target="blank" name="stackoverflow">
        <i title="Stackoverflow" class="fa fa-stack-overflow"></i>
      </a>
    </li>
    <li class="socialIcons socialIcons-googlegroups">
      <a href="https://groups.google.com/forum/#!forum/arangodb" target="blank" name="google groups">
        <img title="Google Groups" alt="Google Groups" src="https://docs.arangodb.com/assets/googlegroupsIcon.png" />
      </a>
    </li>
  </ul>
</div>
        
    <div class="book"
        data-level="9.5"
        data-chapter-title="Joins"
        data-filepath="Examples/Join.md"
        data-basepath=".."
        data-revision="Thu Jun 02 2016 11:44:53 GMT+0000 (UTC)"
        data-innerlanguage="">
    

<div class="book-summary">
    <nav role="navigation">
        <ul class="summary">
            
            
            
            

            

            
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="../index.html">
                
                        <i class="fa fa-check"></i>
                        
                        Introduction
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1" data-path="Invocation/index.html">
            
                
                    <a href="../Invocation/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                        How to invoke AQL
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1" data-path="Invocation/WithArangosh.html">
            
                
                    <a href="../Invocation/WithArangosh.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.</b>
                        
                        with Arangosh
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="Invocation/WithWebInterface.html">
            
                
                    <a href="../Invocation/WithWebInterface.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.2.</b>
                        
                        with the Web Interface
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2" data-path="Fundamentals/index.html">
            
                
                    <a href="../Fundamentals/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                        AQL Fundamentals
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1" data-path="Fundamentals/Syntax.html">
            
                
                    <a href="../Fundamentals/Syntax.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.</b>
                        
                        AQL Syntax
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="Fundamentals/DataTypes.html">
            
                
                    <a href="../Fundamentals/DataTypes.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.2.</b>
                        
                        Data types
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="Fundamentals/BindParameters.html">
            
                
                    <a href="../Fundamentals/BindParameters.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.3.</b>
                        
                        Bind Parameters
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="Fundamentals/TypeValueOrder.html">
            
                
                    <a href="../Fundamentals/TypeValueOrder.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.4.</b>
                        
                        Type and value order
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.5" data-path="Fundamentals/DocumentData.html">
            
                
                    <a href="../Fundamentals/DocumentData.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.5.</b>
                        
                        Accessing data from collections
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.6" data-path="Fundamentals/QueryResults.html">
            
                
                    <a href="../Fundamentals/QueryResults.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.6.</b>
                        
                        Query Results
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.7" data-path="Fundamentals/QueryErrors.html">
            
                
                    <a href="../Fundamentals/QueryErrors.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.7.</b>
                        
                        Query Errors
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3" data-path="Operators.html">
            
                
                    <a href="../Operators.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                        Operators
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4" data-path="DataModification.html">
            
                
                    <a href="../DataModification.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.</b>
                        
                        Data Modification Queries
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5" data-path="Operations/index.html">
            
                
                    <a href="../Operations/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.</b>
                        
                        High level Operations
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1" data-path="Operations/For.html">
            
                
                    <a href="../Operations/For.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.1.</b>
                        
                        FOR
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.2" data-path="Operations/Return.html">
            
                
                    <a href="../Operations/Return.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.2.</b>
                        
                        RETURN
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.3" data-path="Operations/Filter.html">
            
                
                    <a href="../Operations/Filter.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.3.</b>
                        
                        FILTER
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.4" data-path="Operations/Sort.html">
            
                
                    <a href="../Operations/Sort.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.4.</b>
                        
                        SORT
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.5" data-path="Operations/Limit.html">
            
                
                    <a href="../Operations/Limit.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.5.</b>
                        
                        LIMIT
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.6" data-path="Operations/Let.html">
            
                
                    <a href="../Operations/Let.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.6.</b>
                        
                        LET
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.7" data-path="Operations/Collect.html">
            
                
                    <a href="../Operations/Collect.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.7.</b>
                        
                        COLLECT
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.8" data-path="Operations/Remove.html">
            
                
                    <a href="../Operations/Remove.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.8.</b>
                        
                        REMOVE
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.9" data-path="Operations/Update.html">
            
                
                    <a href="../Operations/Update.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.9.</b>
                        
                        UPDATE
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.10" data-path="Operations/Replace.html">
            
                
                    <a href="../Operations/Replace.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.10.</b>
                        
                        REPLACE
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.11" data-path="Operations/Insert.html">
            
                
                    <a href="../Operations/Insert.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.11.</b>
                        
                        INSERT
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.12" data-path="Operations/Upsert.html">
            
                
                    <a href="../Operations/Upsert.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.12.</b>
                        
                        UPSERT
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="6" data-path="Functions/index.html">
            
                
                    <a href="../Functions/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.</b>
                        
                        Functions
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="6.1" data-path="Functions/TypeCast.html">
            
                
                    <a href="../Functions/TypeCast.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.1.</b>
                        
                        Type cast
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.2" data-path="Functions/String.html">
            
                
                    <a href="../Functions/String.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.2.</b>
                        
                        String
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.3" data-path="Functions/Numeric.html">
            
                
                    <a href="../Functions/Numeric.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.3.</b>
                        
                        Numeric
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.4" data-path="Functions/Date.html">
            
                
                    <a href="../Functions/Date.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.4.</b>
                        
                        Date
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.5" data-path="Functions/Array.html">
            
                
                    <a href="../Functions/Array.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.5.</b>
                        
                        Array
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.6" data-path="Functions/Document.html">
            
                
                    <a href="../Functions/Document.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.6.</b>
                        
                        Object / Document
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.7" data-path="Functions/Geo.html">
            
                
                    <a href="../Functions/Geo.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.7.</b>
                        
                        Geo
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.8" data-path="Functions/Fulltext.html">
            
                
                    <a href="../Functions/Fulltext.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.8.</b>
                        
                        Fulltext
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.9" data-path="Functions/Miscellaneous.html">
            
                
                    <a href="../Functions/Miscellaneous.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.9.</b>
                        
                        Miscellaneous
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="7" data-path="Graphs/index.html">
            
                
                    <a href="../Graphs/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.</b>
                        
                        Graphs
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="7.1" data-path="Graphs/Traversals.html">
            
                
                    <a href="../Graphs/Traversals.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.1.</b>
                        
                        Traversal
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="7.2" data-path="Graphs/Operations.html">
            
                
                    <a href="../Graphs/Operations.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.2.</b>
                        
                        Named Operations
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="7.3" data-path="Graphs/Functions.html">
            
                
                    <a href="../Graphs/Functions.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.3.</b>
                        
                        Other
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="8" data-path="Advanced/index.html">
            
                
                    <a href="../Advanced/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.</b>
                        
                        Advanced Features
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="8.1" data-path="Advanced/ArrayOperators.html">
            
                
                    <a href="../Advanced/ArrayOperators.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.1.</b>
                        
                        Array Operators
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="9" data-path="Examples/index.html">
            
                
                    <a href="../Examples/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.</b>
                        
                        Usual Query Patterns
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="9.1" data-path="Examples/Counting.html">
            
                
                    <a href="../Examples/Counting.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.1.</b>
                        
                        Counting
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="9.2" data-path="Examples/DataModificationQueries.html">
            
                
                    <a href="../Examples/DataModificationQueries.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.2.</b>
                        
                        Data-modification queries
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="9.3" data-path="Examples/CombiningQueries.html">
            
                
                    <a href="../Examples/CombiningQueries.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.3.</b>
                        
                        Subqueries
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="9.4" data-path="Examples/ProjectionsAndFilters.html">
            
                
                    <a href="../Examples/ProjectionsAndFilters.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.4.</b>
                        
                        Projections and filters
                    </a>
            
            
        </li>
    
        <li class="chapter active" data-level="9.5" data-path="Examples/Join.html">
            
                
                    <a href="../Examples/Join.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.5.</b>
                        
                        Joins
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="9.6" data-path="Examples/Grouping.html">
            
                
                    <a href="../Examples/Grouping.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.6.</b>
                        
                        Grouping
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="9.7" data-path="Examples/CombiningGraphTraversals.html">
            
                
                    <a href="../Examples/CombiningGraphTraversals.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.7.</b>
                        
                        Traversals
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="9.8" data-path="Examples/QueriesNoCollections.html">
            
                
                    <a href="../Examples/QueriesNoCollections.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.8.</b>
                        
                        Queries without collections
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="10" data-path="Extending/index.html">
            
                
                    <a href="../Extending/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>10.</b>
                        
                        User Functions
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="10.1" data-path="Extending/Conventions.html">
            
                
                    <a href="../Extending/Conventions.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>10.1.</b>
                        
                        Conventions
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="10.2" data-path="Extending/Functions.html">
            
                
                    <a href="../Extending/Functions.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>10.2.</b>
                        
                        Registering Functions
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="11" data-path="ExecutionAndPerformance/index.html">
            
                
                    <a href="../ExecutionAndPerformance/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>11.</b>
                        
                        Execution and Performance
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="11.1" data-path="ExecutionAndPerformance/QueryStatistics.html">
            
                
                    <a href="../ExecutionAndPerformance/QueryStatistics.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>11.1.</b>
                        
                        Query statistics
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="11.2" data-path="ExecutionAndPerformance/ParsingQueries.html">
            
                
                    <a href="../ExecutionAndPerformance/ParsingQueries.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>11.2.</b>
                        
                        Parsing queries
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="11.3" data-path="ExecutionAndPerformance/ExplainingQueries.html">
            
                
                    <a href="../ExecutionAndPerformance/ExplainingQueries.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>11.3.</b>
                        
                        Explaining queries
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="11.4" data-path="ExecutionAndPerformance/Optimizer.html">
            
                
                    <a href="../ExecutionAndPerformance/Optimizer.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>11.4.</b>
                        
                        Optimizing queries
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="11.5" data-path="ExecutionAndPerformance/QueryCache.html">
            
                
                    <a href="../ExecutionAndPerformance/QueryCache.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>11.5.</b>
                        
                        Caching query results
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="12" data-path="CommonErrors.html">
            
                
                    <a href="../CommonErrors.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>12.</b>
                        
                        Common Errors
                    </a>
            
            
        </li>
    


            
            <li class="divider"></li>
            <li>
                <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                    Published with GitBook
                </a>
            </li>
            
        </ul>
    </nav>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header" role="navigation">
    <!-- Actions Left -->
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../" >ArangoDB v3.0.x-devel (2016-06-02) AQL Documentation</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1" role="main">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <p><a name="joins"></a></p>
<h1 id="joins">Joins</h1>
<p>So far we have only dealt with one collection (<em>users</em>) at a time. We also have a 
collection <em>relations</em> that stores relationships between users. We will now use
this extra collection to create a result from two collections.</p>
<p>First of all, we&apos;ll query a few users together with their friends&apos; ids. For that,
we&apos;ll use all <em>relations</em> that have a value of <em>friend</em> in their <em>type</em> attribute.
Relationships are established by using the <em>friendOf</em> and <em>thisUser</em> attributes in the
<em>relations</em> collection, which point to the <em>userId</em> values in the <em>users</em> collection.</p>
<p><a name="join_tuples"></a></p>
<h3 id="join-tuples">Join tuples</h3>
<p>We&apos;ll start with a SQL-ish result set and return each tuple (user name, friends userId) 
separately. The AQL query to generate such result is:</p>
<pre><code class="lang-js">FOR u IN users
  FILTER u.active == <span class="hljs-literal">true</span>
  LIMIT <span class="hljs-number">0</span>, <span class="hljs-number">4</span>
  FOR f IN relations
    FILTER f.type == <span class="hljs-string">&quot;friend&quot;</span> &amp;&amp; f.friendOf == u.userId
    RETURN {
      <span class="hljs-string">&quot;user&quot;</span> : u.name,
      <span class="hljs-string">&quot;friendId&quot;</span> : f.thisUser
    }
</code></pre>
<pre><code class="lang-json">[
  {
    <span class="hljs-string">&quot;user&quot;</span> : <span class="hljs-string">&quot;Abigail&quot;</span>,
    <span class="hljs-string">&quot;friendId&quot;</span> : <span class="hljs-number">108</span>
  },
  {
    <span class="hljs-string">&quot;user&quot;</span> : <span class="hljs-string">&quot;Abigail&quot;</span>,
    <span class="hljs-string">&quot;friendId&quot;</span> : <span class="hljs-number">102</span>
  },
  {
    <span class="hljs-string">&quot;user&quot;</span> : <span class="hljs-string">&quot;Abigail&quot;</span>,
    <span class="hljs-string">&quot;friendId&quot;</span> : <span class="hljs-number">106</span>
  },
  {
    <span class="hljs-string">&quot;user&quot;</span> : <span class="hljs-string">&quot;Fred&quot;</span>,
    <span class="hljs-string">&quot;friendId&quot;</span> : <span class="hljs-number">209</span>
  },
  {
    <span class="hljs-string">&quot;user&quot;</span> : <span class="hljs-string">&quot;Mary&quot;</span>,
    <span class="hljs-string">&quot;friendId&quot;</span> : <span class="hljs-number">207</span>
  },
  {
    <span class="hljs-string">&quot;user&quot;</span> : <span class="hljs-string">&quot;Mary&quot;</span>,
    <span class="hljs-string">&quot;friendId&quot;</span> : <span class="hljs-number">104</span>
  },
  {
    <span class="hljs-string">&quot;user&quot;</span> : <span class="hljs-string">&quot;Mariah&quot;</span>,
    <span class="hljs-string">&quot;friendId&quot;</span> : <span class="hljs-number">203</span>
  },
  {
    <span class="hljs-string">&quot;user&quot;</span> : <span class="hljs-string">&quot;Mariah&quot;</span>,
    <span class="hljs-string">&quot;friendId&quot;</span> : <span class="hljs-number">205</span>
  }
]
</code></pre>
<p>We iterate over the collection users. Only the &apos;active&apos; users will be examined.
For each of these users we will search for up to 4 friends. We locate friends
by comparing the <em>userId</em> of our current user with the <em>friendOf</em> attribute of the
<em>relations</em> document. For each of those relations found we return the users name
and the userId of the friend.</p>
<p><a name="horizontal_lists"></a></p>
<h3 id="horizontal-lists">Horizontal lists</h3>
<p>Note that in the above result, a user can be returned multiple times. This is the
SQL way of returning data. If this is not desired, the friends&apos; ids of each user
can be returned in a horizontal list. This will return each user at most once.</p>
<p>The AQL query for doing so is:</p>
<pre><code class="lang-js">FOR u IN users
  FILTER u.active == <span class="hljs-literal">true</span> LIMIT <span class="hljs-number">0</span>, <span class="hljs-number">4</span>
  RETURN {
    <span class="hljs-string">&quot;user&quot;</span> : u.name,
    <span class="hljs-string">&quot;friendIds&quot;</span> : (
      FOR f IN relations
        FILTER f.friendOf == u.userId &amp;&amp; f.type == <span class="hljs-string">&quot;friend&quot;</span>
        RETURN f.thisUser
    )
  }
</code></pre>
<pre><code class="lang-json">[
  {
    <span class="hljs-string">&quot;user&quot;</span> : <span class="hljs-string">&quot;Abigail&quot;</span>,
    <span class="hljs-string">&quot;friendIds&quot;</span> : [
      <span class="hljs-number">108</span>,
      <span class="hljs-number">102</span>,
      <span class="hljs-number">106</span>
    ]
  },
  {
    <span class="hljs-string">&quot;user&quot;</span> : <span class="hljs-string">&quot;Fred&quot;</span>,
    <span class="hljs-string">&quot;friendIds&quot;</span> : [
      <span class="hljs-number">209</span>
    ]
  },
  {
    <span class="hljs-string">&quot;user&quot;</span> : <span class="hljs-string">&quot;Mary&quot;</span>,
    <span class="hljs-string">&quot;friendIds&quot;</span> : [
      <span class="hljs-number">207</span>,
      <span class="hljs-number">104</span>
    ]
  },
  {
    <span class="hljs-string">&quot;user&quot;</span> : <span class="hljs-string">&quot;Mariah&quot;</span>,
    <span class="hljs-string">&quot;friendIds&quot;</span> : [
      <span class="hljs-number">203</span>,
      <span class="hljs-number">205</span>
    ]
  }
]
</code></pre>
<p>In this query we are still iterating over the users in the <em>users</em> collection
and for each matching user we are executing a subquery to create the matching
list of related users.</p>
<p><a name="self_joins"></a></p>
<h3 id="self-joins">Self joins</h3>
<p>To not only return friend ids but also the names of friends, we could &quot;join&quot; the
<em>users</em> collection once more (something like a &quot;self join&quot;):</p>
<pre><code class="lang-js">FOR u IN users
  FILTER u.active == <span class="hljs-literal">true</span>
  LIMIT <span class="hljs-number">0</span>, <span class="hljs-number">4</span>
  RETURN {
    <span class="hljs-string">&quot;user&quot;</span> : u.name,
    <span class="hljs-string">&quot;friendIds&quot;</span> : (
      FOR f IN relations
        FILTER f.friendOf == u.userId &amp;&amp; f.type == <span class="hljs-string">&quot;friend&quot;</span>
        FOR u2 IN users
          FILTER f.thisUser == u2.useId
          RETURN u2.name
    )
  }
</code></pre>
<pre><code class="lang-json">[
  {
    <span class="hljs-string">&quot;user&quot;</span> : <span class="hljs-string">&quot;Abigail&quot;</span>,
    <span class="hljs-string">&quot;friendIds&quot;</span> : [
      <span class="hljs-string">&quot;Jim&quot;</span>,
      <span class="hljs-string">&quot;Jacob&quot;</span>,
      <span class="hljs-string">&quot;Daniel&quot;</span>
    ]
  },
  {
    <span class="hljs-string">&quot;user&quot;</span> : <span class="hljs-string">&quot;Fred&quot;</span>,
    <span class="hljs-string">&quot;friendIds&quot;</span> : [
      <span class="hljs-string">&quot;Mariah&quot;</span>
    ]
  },
  {
    <span class="hljs-string">&quot;user&quot;</span> : <span class="hljs-string">&quot;Mary&quot;</span>,
    <span class="hljs-string">&quot;friendIds&quot;</span> : [
      <span class="hljs-string">&quot;Isabella&quot;</span>,
      <span class="hljs-string">&quot;Michael&quot;</span>
    ]
  },
  {
    <span class="hljs-string">&quot;user&quot;</span> : <span class="hljs-string">&quot;Mariah&quot;</span>,
    <span class="hljs-string">&quot;friendIds&quot;</span> : [
      <span class="hljs-string">&quot;Madison&quot;</span>,
      <span class="hljs-string">&quot;Eva&quot;</span>
    ]
  }
]
</code></pre>
<p>This query will then again in term fetch the clear text name of the
friend from the users collection. So here we iterate the users collection,
and for each hit the relations collection, and for each hit once more the
users collection.</p>
<p><a name="outer_joins"></a></p>
<h3 id="outer-joins">Outer joins</h3>
<p>Lets find the lonely people in our database - those without friends.</p>
<pre><code class="lang-js">
FOR user IN users
  LET friendList = (
    FOR f IN relations
      FILTER f.friendOf == u.userId
      RETURN <span class="hljs-number">1</span>
  )
  FILTER LENGTH(friendList) == <span class="hljs-number">0</span>
  RETURN { <span class="hljs-string">&quot;user&quot;</span> : user.name }
</code></pre>
<pre><code class="lang-json">[
  {
    <span class="hljs-string">&quot;user&quot;</span> : <span class="hljs-string">&quot;Abigail&quot;</span>
  },
  {
    <span class="hljs-string">&quot;user&quot;</span> : <span class="hljs-string">&quot;Fred&quot;</span>
  }
]
</code></pre>
<p>So, for each user we pick the list of her friends and count them. The ones where
count equals zero are the lonely people. Using <em>RETURN 1</em> in the subquery
saves even more precious CPU cycles and gives the optimizer more alternatives.</p>
<p><a name="pitfalls"></a></p>
<h3 id="pitfalls">Pitfalls</h3>
<p>Since we&apos;re free of schemata, there is by default no way to tell the format of the
documents. So, if your documents don&apos;t contain an attribute, it defaults to
null. We can however check our data for accuracy like this:</p>
<pre><code class="lang-js">RETURN LENGTH(FOR u IN users FILTER u.userId == <span class="hljs-literal">null</span> RETURN <span class="hljs-number">1</span>)
</code></pre>
<pre><code class="lang-json">[
  <span class="hljs-number">10000</span>
]
</code></pre>
<pre><code class="lang-js">RETURN LENGTH(FOR f IN relations FILTER f.friendOf == <span class="hljs-literal">null</span> RETURN <span class="hljs-number">1</span>)
</code></pre>
<pre><code class="lang-json">[
  <span class="hljs-number">10000</span>
]
</code></pre>
<p>So that the above queries return 10k matches each, the result of i.e. the Join
tuples query will become 100.000.000 items large and will use much memory plus
computation time. So it is generally a good idea to revalidate that the criteria
for your join conditions exist.</p>
<p>Using indices on the properties can speed up the operation significantly.
You can use the explain helper to revalidate your query actually uses them.</p>
<p>If you work with joins on edge collections you would typically aggregate over
the internal fields <em>_id</em>, <em>_from</em> and <em>_to</em> (where <em>_id</em> equals <em>userId</em>,
<em>_from</em> <em>friendOf</em> and <em>_to</em> would be <em>thisUser</em> in our examples). ArangoDB
implicitly creates indices on them.</p>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="../Examples/ProjectionsAndFilters.html" class="navigation navigation-prev " aria-label="Previous page: Projections and filters"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="../Examples/Grouping.html" class="navigation navigation-next " aria-label="Next page: Grouping"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="../gitbook/app.js"></script>

    
    <script src="../gitbook/plugins/gitbook-plugin-toggle-chapters/toggle.js"></script>
    

    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/3.1.1/anchor.min.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-anchorjs/anchor-style.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-piwik/plugin.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-fontsettings/buttons.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"addcssjs":{"js":["styles/header.js"],"css":["styles/header.css"]},"add-header":{"BASE_PATH":"https://docs.arangodb.com/devel"},"piwik":{"URL":"www.arangodb.com/piwik/","siteId":12},"toggle-chapters":{},"anchorjs":{},"highlight":{},"fontsettings":{"theme":"white","family":"sans","size":2}};
    gitbook.start(config);
});
</script>

        <!-- body:end -->
<script type="text/javascript">var _paq = _paq || [];_paq.push(['trackPageView']);_paq.push(['enableLinkTracking']);(function() {var u=(("https:" == document.location.protocol) ? "https" : "http") + "://www.arangodb.com/piwik/";_paq.push(['setTrackerUrl', u+'piwik.php']);_paq.push(['setSiteId', 12]);var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0]; g.type='text/javascript';g.defer=true; g.async=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);})();</script><noscript><p><img src="http://www.arangodb.com/piwik/piwik.php?idsite=12" style="border:0;" alt="" /></p></noscript>
    </body>
    <!-- End of book ArangoDB v3.0.x-devel (2016-06-02) AQL Documentation -->
</html>
