<!DOCTYPE HTML>
<html lang="en" >
    <!-- Start book ArangoDB v3.0.x-devel (2016-06-02) AQL Documentation -->
    <head>
        <!-- head:start -->
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>UPSERT | ArangoDB v3.0.x-devel (2016-06-02) AQL Documentation</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.6.7">
        <meta name="author" content="ArangoDB GmbH">
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">
        
    <link rel="stylesheet" href="../gitbook/style.css">
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-toggle-chapters/toggle.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-highlight/website.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-fontsettings/website.css">
        
    
    
        <link rel="stylesheet" href="../styles/website.css">
    

        
    
    
    <link rel="next" href="../Functions/index.html" />
    
    
    <link rel="prev" href="../Operations/Insert.html" />
    

        <!-- head:end -->
<script type="text/javascript" src="../styles/header.js"></script><link rel="stylesheet" type="text/css" href="../styles/header.css">
    </head>
    <body>
        <!-- body:start -->
<div id="header">
  <div id="logo">
    <a href="https://arangodb.com/">
      <img src="https://docs.arangodb.com/assets/arangodb_logo_2016.png">
    </a>
  </div>
  <div id="logo-small">
    <a href="https://arangodb.com/">
      <img src="https://docs.arangodb.com/assets/arangodb_logo_small_2016.png">
    </a>
  </div>
  <select id="version-switcher">
    <option value="devel">v3.0.x-devel (2016-06-02)</option>
    <option value="2.8">v2.8</option>
    <option value="2.7">v2.7</option>
    <option value="2.6">v2.6</option>
    <option value="2.5">v2.5</option>
    <option value="2.4">v2.4</option>
    <option value="2.3">v2.3</option>
    <option value="2.2">v2.2</option>
    <option value="2.1">v2.1</option>
  </select>
  <div class="google-search">
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
  <ul id="navmenu">
    <li>
      <a href="https://docs.arangodb.com/devel/Manual/index.html">Manual</a>
    </li>
    <li class="active-tab">
      <a href="https://docs.arangodb.com/devel/AQL/index.html">AQL</a>
    </li>
    <li>
      <a href="https://docs.arangodb.com/devel/HTTP/index.html">HTTP</a>
    </li>
    <li>
      <a href="https://docs.arangodb.com/cookbook">Cookbook</a>
    </li>
    <li class="socialIcons">
      <a href="https://github.com/ArangoDB/ArangoDB/issues" target="blank" name="github">
        <i title="GitHub" class="fa fa-github"></i>
      </a>
    </li>
    <li class="socialIcons">
      <a href="http://stackoverflow.com/questions/tagged/arangodb" target="blank" name="stackoverflow">
        <i title="Stackoverflow" class="fa fa-stack-overflow"></i>
      </a>
    </li>
    <li class="socialIcons socialIcons-googlegroups">
      <a href="https://groups.google.com/forum/#!forum/arangodb" target="blank" name="google groups">
        <img title="Google Groups" alt="Google Groups" src="https://docs.arangodb.com/assets/googlegroupsIcon.png" />
      </a>
    </li>
  </ul>
</div>
        
    <div class="book"
        data-level="5.12"
        data-chapter-title="UPSERT"
        data-filepath="Operations/Upsert.md"
        data-basepath=".."
        data-revision="Thu Jun 02 2016 11:44:53 GMT+0000 (UTC)"
        data-innerlanguage="">
    

<div class="book-summary">
    <nav role="navigation">
        <ul class="summary">
            
            
            
            

            

            
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="../index.html">
                
                        <i class="fa fa-check"></i>
                        
                        Introduction
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1" data-path="Invocation/index.html">
            
                
                    <a href="../Invocation/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                        How to invoke AQL
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1" data-path="Invocation/WithArangosh.html">
            
                
                    <a href="../Invocation/WithArangosh.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.</b>
                        
                        with Arangosh
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="Invocation/WithWebInterface.html">
            
                
                    <a href="../Invocation/WithWebInterface.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.2.</b>
                        
                        with the Web Interface
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2" data-path="Fundamentals/index.html">
            
                
                    <a href="../Fundamentals/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                        AQL Fundamentals
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1" data-path="Fundamentals/Syntax.html">
            
                
                    <a href="../Fundamentals/Syntax.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.</b>
                        
                        AQL Syntax
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="Fundamentals/DataTypes.html">
            
                
                    <a href="../Fundamentals/DataTypes.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.2.</b>
                        
                        Data types
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="Fundamentals/BindParameters.html">
            
                
                    <a href="../Fundamentals/BindParameters.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.3.</b>
                        
                        Bind Parameters
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="Fundamentals/TypeValueOrder.html">
            
                
                    <a href="../Fundamentals/TypeValueOrder.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.4.</b>
                        
                        Type and value order
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.5" data-path="Fundamentals/DocumentData.html">
            
                
                    <a href="../Fundamentals/DocumentData.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.5.</b>
                        
                        Accessing data from collections
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.6" data-path="Fundamentals/QueryResults.html">
            
                
                    <a href="../Fundamentals/QueryResults.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.6.</b>
                        
                        Query Results
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.7" data-path="Fundamentals/QueryErrors.html">
            
                
                    <a href="../Fundamentals/QueryErrors.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.7.</b>
                        
                        Query Errors
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3" data-path="Operators.html">
            
                
                    <a href="../Operators.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                        Operators
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4" data-path="DataModification.html">
            
                
                    <a href="../DataModification.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.</b>
                        
                        Data Modification Queries
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5" data-path="Operations/index.html">
            
                
                    <a href="../Operations/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.</b>
                        
                        High level Operations
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1" data-path="Operations/For.html">
            
                
                    <a href="../Operations/For.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.1.</b>
                        
                        FOR
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.2" data-path="Operations/Return.html">
            
                
                    <a href="../Operations/Return.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.2.</b>
                        
                        RETURN
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.3" data-path="Operations/Filter.html">
            
                
                    <a href="../Operations/Filter.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.3.</b>
                        
                        FILTER
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.4" data-path="Operations/Sort.html">
            
                
                    <a href="../Operations/Sort.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.4.</b>
                        
                        SORT
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.5" data-path="Operations/Limit.html">
            
                
                    <a href="../Operations/Limit.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.5.</b>
                        
                        LIMIT
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.6" data-path="Operations/Let.html">
            
                
                    <a href="../Operations/Let.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.6.</b>
                        
                        LET
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.7" data-path="Operations/Collect.html">
            
                
                    <a href="../Operations/Collect.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.7.</b>
                        
                        COLLECT
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.8" data-path="Operations/Remove.html">
            
                
                    <a href="../Operations/Remove.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.8.</b>
                        
                        REMOVE
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.9" data-path="Operations/Update.html">
            
                
                    <a href="../Operations/Update.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.9.</b>
                        
                        UPDATE
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.10" data-path="Operations/Replace.html">
            
                
                    <a href="../Operations/Replace.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.10.</b>
                        
                        REPLACE
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.11" data-path="Operations/Insert.html">
            
                
                    <a href="../Operations/Insert.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.11.</b>
                        
                        INSERT
                    </a>
            
            
        </li>
    
        <li class="chapter active" data-level="5.12" data-path="Operations/Upsert.html">
            
                
                    <a href="../Operations/Upsert.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.12.</b>
                        
                        UPSERT
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="6" data-path="Functions/index.html">
            
                
                    <a href="../Functions/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.</b>
                        
                        Functions
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="6.1" data-path="Functions/TypeCast.html">
            
                
                    <a href="../Functions/TypeCast.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.1.</b>
                        
                        Type cast
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.2" data-path="Functions/String.html">
            
                
                    <a href="../Functions/String.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.2.</b>
                        
                        String
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.3" data-path="Functions/Numeric.html">
            
                
                    <a href="../Functions/Numeric.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.3.</b>
                        
                        Numeric
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.4" data-path="Functions/Date.html">
            
                
                    <a href="../Functions/Date.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.4.</b>
                        
                        Date
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.5" data-path="Functions/Array.html">
            
                
                    <a href="../Functions/Array.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.5.</b>
                        
                        Array
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.6" data-path="Functions/Document.html">
            
                
                    <a href="../Functions/Document.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.6.</b>
                        
                        Object / Document
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.7" data-path="Functions/Geo.html">
            
                
                    <a href="../Functions/Geo.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.7.</b>
                        
                        Geo
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.8" data-path="Functions/Fulltext.html">
            
                
                    <a href="../Functions/Fulltext.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.8.</b>
                        
                        Fulltext
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.9" data-path="Functions/Miscellaneous.html">
            
                
                    <a href="../Functions/Miscellaneous.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.9.</b>
                        
                        Miscellaneous
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="7" data-path="Graphs/index.html">
            
                
                    <a href="../Graphs/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.</b>
                        
                        Graphs
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="7.1" data-path="Graphs/Traversals.html">
            
                
                    <a href="../Graphs/Traversals.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.1.</b>
                        
                        Traversal
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="7.2" data-path="Graphs/Operations.html">
            
                
                    <a href="../Graphs/Operations.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.2.</b>
                        
                        Named Operations
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="7.3" data-path="Graphs/Functions.html">
            
                
                    <a href="../Graphs/Functions.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.3.</b>
                        
                        Other
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="8" data-path="Advanced/index.html">
            
                
                    <a href="../Advanced/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.</b>
                        
                        Advanced Features
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="8.1" data-path="Advanced/ArrayOperators.html">
            
                
                    <a href="../Advanced/ArrayOperators.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.1.</b>
                        
                        Array Operators
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="9" data-path="Examples/index.html">
            
                
                    <a href="../Examples/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.</b>
                        
                        Usual Query Patterns
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="9.1" data-path="Examples/Counting.html">
            
                
                    <a href="../Examples/Counting.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.1.</b>
                        
                        Counting
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="9.2" data-path="Examples/DataModificationQueries.html">
            
                
                    <a href="../Examples/DataModificationQueries.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.2.</b>
                        
                        Data-modification queries
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="9.3" data-path="Examples/CombiningQueries.html">
            
                
                    <a href="../Examples/CombiningQueries.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.3.</b>
                        
                        Subqueries
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="9.4" data-path="Examples/ProjectionsAndFilters.html">
            
                
                    <a href="../Examples/ProjectionsAndFilters.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.4.</b>
                        
                        Projections and filters
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="9.5" data-path="Examples/Join.html">
            
                
                    <a href="../Examples/Join.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.5.</b>
                        
                        Joins
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="9.6" data-path="Examples/Grouping.html">
            
                
                    <a href="../Examples/Grouping.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.6.</b>
                        
                        Grouping
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="9.7" data-path="Examples/CombiningGraphTraversals.html">
            
                
                    <a href="../Examples/CombiningGraphTraversals.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.7.</b>
                        
                        Traversals
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="9.8" data-path="Examples/QueriesNoCollections.html">
            
                
                    <a href="../Examples/QueriesNoCollections.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.8.</b>
                        
                        Queries without collections
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="10" data-path="Extending/index.html">
            
                
                    <a href="../Extending/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>10.</b>
                        
                        User Functions
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="10.1" data-path="Extending/Conventions.html">
            
                
                    <a href="../Extending/Conventions.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>10.1.</b>
                        
                        Conventions
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="10.2" data-path="Extending/Functions.html">
            
                
                    <a href="../Extending/Functions.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>10.2.</b>
                        
                        Registering Functions
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="11" data-path="ExecutionAndPerformance/index.html">
            
                
                    <a href="../ExecutionAndPerformance/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>11.</b>
                        
                        Execution and Performance
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="11.1" data-path="ExecutionAndPerformance/QueryStatistics.html">
            
                
                    <a href="../ExecutionAndPerformance/QueryStatistics.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>11.1.</b>
                        
                        Query statistics
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="11.2" data-path="ExecutionAndPerformance/ParsingQueries.html">
            
                
                    <a href="../ExecutionAndPerformance/ParsingQueries.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>11.2.</b>
                        
                        Parsing queries
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="11.3" data-path="ExecutionAndPerformance/ExplainingQueries.html">
            
                
                    <a href="../ExecutionAndPerformance/ExplainingQueries.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>11.3.</b>
                        
                        Explaining queries
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="11.4" data-path="ExecutionAndPerformance/Optimizer.html">
            
                
                    <a href="../ExecutionAndPerformance/Optimizer.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>11.4.</b>
                        
                        Optimizing queries
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="11.5" data-path="ExecutionAndPerformance/QueryCache.html">
            
                
                    <a href="../ExecutionAndPerformance/QueryCache.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>11.5.</b>
                        
                        Caching query results
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="12" data-path="CommonErrors.html">
            
                
                    <a href="../CommonErrors.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>12.</b>
                        
                        Common Errors
                    </a>
            
            
        </li>
    


            
            <li class="divider"></li>
            <li>
                <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                    Published with GitBook
                </a>
            </li>
            
        </ul>
    </nav>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header" role="navigation">
    <!-- Actions Left -->
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../" >ArangoDB v3.0.x-devel (2016-06-02) AQL Documentation</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1" role="main">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <p><a name="upsert"></a></p>
<h1 id="upsert">UPSERT</h1>
<p>The <em>UPSERT</em> keyword can be used for checking whether certain documents exist,
and to update them in case they exist, or create them in case they do not exist.
On a single server, upserts are executed transactionally in an all-or-nothing fashion. 
For sharded collections, the entire update operation is not transactional.</p>
<p>Each <em>UPSERT</em> operation is restricted to a single collection, and the 
<a href="../../Manual/Appendix/Glossary.html#collection-name">collection name</a> must not be dynamic.
Only a single <em>UPSERT</em> statement per collection is allowed per AQL query, and 
it cannot be followed by read operations that access the same collection, by
traversal operations, or AQL functions that can read documents.</p>
<p>The syntax for an upsert operation is:</p>
<pre><code>UPSERT search-expression INSERT insert-expression UPDATE update-expression IN collection options
UPSERT search-expression INSERT insert-expression REPLACE update-expression IN collection options
</code></pre><p>When using the <em>UPDATE</em> variant of the upsert operation, the found document will be 
partially updated, meaning only the attributes specified in <em>update-expression</em> will be 
updated or added. When using the <em>REPLACE</em> variant of upsert, existing documents will 
be replaced with the contexts of <em>update-expression</em>.</p>
<p>Updating a document will modify the document&apos;s revision number with a server-generated value.
The system attributes <em>_id</em>, <em>_key</em> and <em>_rev</em> cannot be updated, <em>_from</em> and <em>_to</em> can.</p>
<p>The <em>search-expression</em> contains the document to be looked for. It must be an object 
literal without dynamic attribute names. In case no such document can be found in
<em>collection</em>, a new document will be inserted into the collection as specified in the
<em>insert-expression</em>. </p>
<p>In case at least one document in <em>collection</em> matches the <em>search-expression</em>, it will
be updated using the <em>update-expression</em>. When more than one document in the collection
matches the <em>search-expression</em>, it is undefined which of the matching documents will
be updated. It is therefore often sensible to make sure by other means (such as unique 
indexes, application logic etc.) that at most one document matches <em>search-expression</em>.</p>
<p>The following query will look in the <em>users</em> collection for a document with a specific
<em>name</em> attribute value. If the document exists, its <em>logins</em> attribute will be increased
by one. If it does not exist, a new document will be inserted, consisting of the
attributes <em>name</em>, <em>logins</em>, and <em>dateCreated</em>:</p>
<pre><code>UPSERT { name: &apos;superuser&apos; } 
INSERT { name: &apos;superuser&apos;, logins: 1, dateCreated: DATE_NOW() } 
UPDATE { logins: OLD.logins + 1 } IN users
</code></pre><p>Note that in the <em>UPDATE</em> case it is possible to refer to the previous version of the
document using the <em>OLD</em> pseudo-value.</p>
<p><a name="setting_query_options"></a></p>
<h3 id="setting-query-options">Setting query options</h3>
<p>As in several above examples, the <em>ignoreErrors</em> option can be used to suppress query 
errors that may occur when trying to violate unique key constraints.</p>
<p>When updating or replacing an attribute with a null value, ArangoDB will not remove the 
attribute from the document but store a null value for it. To get rid of attributes in 
an upsert operation, set them to null and provide the <em>keepNull</em> option.</p>
<p>There is also the option <em>mergeObjects</em> that controls whether object contents will be
merged if an object attribute is present in both the <em>UPDATE</em> query and in the 
to-be-updated document.</p>
<p>Note: the default value for <em>mergeObjects</em> is <em>true</em>, so there is no need to specify it
explicitly.</p>
<p>To make sure data are durable when an update query returns, there is the <em>waitForSync</em> 
query option.</p>
<p><a name="returning_documents"></a></p>
<h3 id="returning-documents">Returning documents</h3>
<p><code>UPSERT</code> statements can optionally return data. To do so, they need to be followed
by a <code>RETURN</code> statement (intermediate <code>LET</code> statements are allowed, too). These statements
can optionally perform calculations and refer to the pseudo-values <code>OLD</code> and <code>NEW</code>.
In case the upsert performed an insert operation, <code>OLD</code> will have a value of <em>null</em>.
In case the upsert performed an update or replace operation, <code>OLD</code> will contain the
previous version of the document, before update/replace.</p>
<p><code>NEW</code> will always be populated. It will contain the inserted document in case the
upsert performed an insert, or the updated/replaced document in case it performed an
update/replace.</p>
<p>This can also be used to check whether the upsert has performed an insert or an update 
internally:</p>
<pre><code>UPSERT { name: &apos;superuser&apos; } 
INSERT { name: &apos;superuser&apos;, logins: 1, dateCreated: DATE_NOW() } 
UPDATE { logins: OLD.logins + 1 } IN users
RETURN { doc: NEW, type: OLD ? &apos;update&apos; : &apos;insert&apos; }
</code></pre>
                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="../Operations/Insert.html" class="navigation navigation-prev " aria-label="Previous page: INSERT"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="../Functions/index.html" class="navigation navigation-next " aria-label="Next page: Functions"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="../gitbook/app.js"></script>

    
    <script src="../gitbook/plugins/gitbook-plugin-toggle-chapters/toggle.js"></script>
    

    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/3.1.1/anchor.min.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-anchorjs/anchor-style.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-piwik/plugin.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-fontsettings/buttons.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"addcssjs":{"js":["styles/header.js"],"css":["styles/header.css"]},"add-header":{"BASE_PATH":"https://docs.arangodb.com/devel"},"piwik":{"URL":"www.arangodb.com/piwik/","siteId":12},"toggle-chapters":{},"anchorjs":{},"highlight":{},"fontsettings":{"theme":"white","family":"sans","size":2}};
    gitbook.start(config);
});
</script>

        <!-- body:end -->
<script type="text/javascript">var _paq = _paq || [];_paq.push(['trackPageView']);_paq.push(['enableLinkTracking']);(function() {var u=(("https:" == document.location.protocol) ? "https" : "http") + "://www.arangodb.com/piwik/";_paq.push(['setTrackerUrl', u+'piwik.php']);_paq.push(['setSiteId', 12]);var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0]; g.type='text/javascript';g.defer=true; g.async=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);})();</script><noscript><p><img src="http://www.arangodb.com/piwik/piwik.php?idsite=12" style="border:0;" alt="" /></p></noscript>
    </body>
    <!-- End of book ArangoDB v3.0.x-devel (2016-06-02) AQL Documentation -->
</html>
