<!DOCTYPE HTML>
<html lang="en" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>Adding Authentication pre-2.5 | Cookbook</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.5.2">
        
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">
        
    <link rel="stylesheet" href="gitbook/style.css">
    
        
        <link rel="stylesheet" href="gitbook/plugins/gitbook-plugin-highlight/website.css">
        
    
        
        <link rel="stylesheet" href="gitbook/plugins/gitbook-plugin-search/search.css">
        
    
        
        <link rel="stylesheet" href="gitbook/plugins/gitbook-plugin-fontsettings/website.css">
        
    
    
        <link rel="stylesheet" href="./styles/website.css">
    

        
    
    
    <link rel="next" href="./MakingRequests.html" />
    
    
    <link rel="prev" href="./FoxxAuth.html" />
    

        <script type="text/javascript" src="styles/header.js"></script><link rel="stylesheet" type="text/css" href="styles/header.css">
    </head>
    <body>
        
        
    <div class="book" data-level="5.4" data-chapter-title="Adding Authentication pre-2.5" data-filepath="FoxxAuthLegacy.md" data-basepath="." data-revision="Fri Jan 29 2016 14:30:11 GMT+0100 (CET)">
    

<div class="book-summary">
    <nav role="navigation">
        <ul class="summary">
            
            
            
            

            

            
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="./index.html">
                
                        <i class="fa fa-check"></i>
                        
                        Introduction
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1" data-path="ModulDocumentInheritance.html">
            
                
                    <a href="./ModulDocumentInheritance.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                        Modelling Document Inheritance
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2" data-path="AccessingShapesData.html">
            
                
                    <a href="./AccessingShapesData.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                        Accessing Shapes Data
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3" >
            
            <span><b>3.</b> AQL</span>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1" data-path="JoinsInAQL.html">
            
                
                    <a href="./JoinsInAQL.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.</b>
                        
                        Using Joins in AQL
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="UsingDynamicAttributeNames.html">
            
                
                    <a href="./UsingDynamicAttributeNames.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.2.</b>
                        
                        Using Dynamic Attribute Names
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="FindingLeafNodesGraph.html">
            
                
                    <a href="./FindingLeafNodesGraph.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.3.</b>
                        
                        Finding Leaf Nodes in a Graph
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.4" data-path="FilteringNodesGraph.html">
            
                
                    <a href="./FilteringNodesGraph.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.4.</b>
                        
                        Filtering Nodes in a Graph
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.5" data-path="CountingNodesEfficientlyGraph.html">
            
                
                    <a href="./CountingNodesEfficientlyGraph.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.5.</b>
                        
                        Counting Nodes efficiently
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.6" data-path="CreatingTestDataAQL.html">
            
                
                    <a href="./CreatingTestDataAQL.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.6.</b>
                        
                        Creating Test-data using AQL
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.7" data-path="DiffingDocuments.html">
            
                
                    <a href="./DiffingDocuments.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.7.</b>
                        
                        Diffing Documents
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.8" data-path="AvoidingInjection.html">
            
                
                    <a href="./AvoidingInjection.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.8.</b>
                        
                        Avoiding Parameter Injection
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.9" data-path="MultilineQueryStrings.html">
            
                
                    <a href="./MultilineQueryStrings.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.9.</b>
                        
                        Multiline Query Strings
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4" >
            
            <span><b>4.</b> Graph-based Recipes</span>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1" data-path="Fulldepth.html">
            
                
                    <a href="./Fulldepth.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.1.</b>
                        
                        Fulldepth Graph-Traversal
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.2" data-path="FindingConnectedVerticesForSubgraphs.html">
            
                
                    <a href="./FindingConnectedVerticesForSubgraphs.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.2.</b>
                        
                        Vertices for Subgraphs
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.3" data-path="JavaDriverGraphExampleVertex.html">
            
                
                    <a href="./JavaDriverGraphExampleVertex.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.3.</b>
                        
                        Vertex example with Java
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.4" data-path="JavaDriverBaseDocument.html">
            
                
                    <a href="./JavaDriverBaseDocument.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.4.</b>
                        
                        Accessing base documents with Java
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.5" data-path="UsingCustomVisitorFromNodeJs.html">
            
                
                    <a href="./UsingCustomVisitorFromNodeJs.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.5.</b>
                        
                        Using a custom Visitor
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.6" data-path="GraphExampleActorsAndMovies.html">
            
                
                    <a href="./GraphExampleActorsAndMovies.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.6.</b>
                        
                        Example AQL Queries for Graphs
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.7" data-path="JavaDriverXmlData.html">
            
                
                    <a href="./JavaDriverXmlData.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.7.</b>
                        
                        Add XML data to ArangoDB with Java
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5" >
            
            <span><b>5.</b> Foxx Framework</span>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1" data-path="FoxxFirstSteps.html">
            
                
                    <a href="./FoxxFirstSteps.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.1.</b>
                        
                        My first Foxx App
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.2" data-path="FoxxFirstStepsLegacy.html">
            
                
                    <a href="./FoxxFirstStepsLegacy.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.2.</b>
                        
                        My first Foxx App pre-2.4
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.3" data-path="FoxxAuth.html">
            
                
                    <a href="./FoxxAuth.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.3.</b>
                        
                        Adding Authentication
                    </a>
            
            
        </li>
    
        <li class="chapter active" data-level="5.4" data-path="FoxxAuthLegacy.html">
            
                
                    <a href="./FoxxAuthLegacy.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.4.</b>
                        
                        Adding Authentication pre-2.5
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.5" data-path="MakingRequests.html">
            
                
                    <a href="./MakingRequests.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.5.</b>
                        
                        Using external APIs
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.6" data-path="FoxxQueues.html">
            
                
                    <a href="./FoxxQueues.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.6.</b>
                        
                        Background jobs
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.7" data-path="FoxxQueuesLegacy.html">
            
                
                    <a href="./FoxxQueuesLegacy.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.7.</b>
                        
                        legacy background jobs
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.8" data-path="FoxxCustomQueueJobsLegacy.html">
            
                
                    <a href="./FoxxCustomQueueJobsLegacy.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.8.</b>
                        
                        legacy custom Background jobs
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.9" data-path="FoxxScripts.html">
            
                
                    <a href="./FoxxScripts.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.9.</b>
                        
                        Creating a Foxx script
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.10" data-path="FoxxCustomQueueJobs.html">
            
                
                    <a href="./FoxxCustomQueueJobs.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.10.</b>
                        
                        Custom job types for Queues
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.11" data-path="FoxxGeneratorFirstSteps.html">
            
                
                    <a href="./FoxxGeneratorFirstSteps.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.11.</b>
                        
                        My first FoxxGenerator App
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.12" data-path="FoxxDeploy.html">
            
                
                    <a href="./FoxxDeploy.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.12.</b>
                        
                        How to deploy a Foxx App
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.13" data-path="MakingFoxxAppAccessible.html">
            
                
                    <a href="./MakingFoxxAppAccessible.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.13.</b>
                        
                        Apps accessible from the Web
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.14" data-path="FoxxApiKeys.html">
            
                
                    <a href="./FoxxApiKeys.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.14.</b>
                        
                        API-Key Management
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.15" data-path="FoxxBinaryFileUploads.html">
            
                
                    <a href="./FoxxBinaryFileUploads.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.15.</b>
                        
                        Handling Binary HTTP documents in Foxx
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.16" data-path="FoxxBinaryHttpPost.html">
            
                
                    <a href="./FoxxBinaryHttpPost.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.16.</b>
                        
                        Sending Binary HTTP documents from Foxx
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.17" data-path="FoxxTesting.html">
            
                
                    <a href="./FoxxTesting.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.17.</b>
                        
                        Foxx Testing
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="6" >
            
            <span><b>6.</b> Use Cases, Examples</span>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="6.1" data-path="CrawlingGithubPromises.html">
            
                
                    <a href="./CrawlingGithubPromises.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.1.</b>
                        
                        Crawling Github with Promises
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.2" data-path="UsingArangoDBWithSailsJS.html">
            
                
                    <a href="./UsingArangoDBWithSailsJS.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.2.</b>
                        
                        Using ArangoDB with Sails.js
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.3" data-path="PopulatingAnAutocompleteTextbox.html">
            
                
                    <a href="./PopulatingAnAutocompleteTextbox.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.3.</b>
                        
                        Populating a Textbox
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.4" data-path="ExportingData.html">
            
                
                    <a href="./ExportingData.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.4.</b>
                        
                        Exporting Data
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="7" >
            
            <span><b>7.</b> ArangoDB Setup / Administration</span>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="7.1" data-path="UsingAuthentication.html">
            
                
                    <a href="./UsingAuthentication.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.1.</b>
                        
                        Using Authentication
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="7.2" data-path="ImportingData.html">
            
                
                    <a href="./ImportingData.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.2.</b>
                        
                        Importing Data
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="7.3" data-path="ReplicatingData.html">
            
                
                    <a href="./ReplicatingData.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.3.</b>
                        
                        Replicating Data
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="7.4" data-path="XCopyInstallWindows.html">
            
                
                    <a href="./XCopyInstallWindows.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.4.</b>
                        
                        XCopy Install Windows
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="7.5" data-path="Compiling.html">
            
                
                    <a href="./Compiling.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.5.</b>
                        
                        Compiling / Build
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="7.5.1" data-path="CompilingOnDebian.html">
            
                
                    <a href="./CompilingOnDebian.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.5.1.</b>
                        
                        Compile on Debian
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="7.5.2" data-path="CompilingUnderWindows.html">
            
                
                    <a href="./CompilingUnderWindows.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.5.2.</b>
                        
                        Compile on Windows
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="7.5.3" data-path="CompilingUnderWindowsLegacy.html">
            
                
                    <a href="./CompilingUnderWindowsLegacy.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.5.3.</b>
                        
                        Compile on Windows pre-2.4
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="7.5.4" data-path="RunningCustomBuild.html">
            
                
                    <a href="./RunningCustomBuild.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.5.4.</b>
                        
                        Running Custom Build
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="8" >
            
            <span><b>8.</b> Cloud, DCOS and Docker</span>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="8.1" data-path="RunningOnAWS.html">
            
                
                    <a href="./RunningOnAWS.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.1.</b>
                        
                        Running on AWS
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.2" data-path="UpdateArangoDBOnAWS.html">
            
                
                    <a href="./UpdateArangoDBOnAWS.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.2.</b>
                        
                        Update on AWS
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.3" data-path="UsingArangoDBAzure.html">
            
                
                    <a href="./UsingArangoDBAzure.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.3.</b>
                        
                        Running on Azure
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.4" data-path="RunningInDockerContainer.html">
            
                
                    <a href="./RunningInDockerContainer.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.4.</b>
                        
                        Docker ArangoDB
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.5" data-path="UsingArangoDBNodeJSDocker.html">
            
                
                    <a href="./UsingArangoDBNodeJSDocker.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.5.</b>
                        
                        Docker with NodeJS App
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.6" data-path="UsingArangoDBInGiantSwarm.html">
            
                
                    <a href="./UsingArangoDBInGiantSwarm.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.6.</b>
                        
                        In the GiantSwarm
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.7" data-path="UsingArangoDBMesosphere.html">
            
                
                    <a href="./UsingArangoDBMesosphere.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.7.</b>
                        
                        ArangoDB in Mesos
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="9" >
            
            <span><b>9.</b> Monitoring</span>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="9.1" data-path="MonitoringWithCollectd.html">
            
                
                    <a href="./MonitoringWithCollectd.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.1.</b>
                        
                        Monitoring with Collectd
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="9.2" data-path="MonitoringSlaveStatus.html">
            
                
                    <a href="./MonitoringSlaveStatus.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.2.</b>
                        
                        Collectd - Replication Slaves
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="9.3" data-path="MonitoringTrafficWithIPAccounting.html">
            
                
                    <a href="./MonitoringTrafficWithIPAccounting.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.3.</b>
                        
                        Collectd - Network usage
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="9.4" data-path="MonitoringOtherRelevantMetrics.html">
            
                
                    <a href="./MonitoringOtherRelevantMetrics.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.4.</b>
                        
                        Collectd - more Metrics
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="9.5" data-path="MonitoringFoxxApps.html">
            
                
                    <a href="./MonitoringFoxxApps.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.5.</b>
                        
                        Collectd - Monitoring Foxx
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    


            
            <li class="divider"></li>
            <li>
                <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                    Published with GitBook
                </a>
            </li>
            
        </ul>
    </nav>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header" role="navigation">
    <!-- Actions Left -->
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="./" >Cookbook</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1" role="main">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <h1 id="foxx-authentication">Foxx Authentication</h1>
<h2 id="problem">Problem</h2>
<p>I want to add authentication to my existing Foxx app: Users need to be able to register, log in and log out. I also want to be able to restrict access to certain routes in my app.</p>
<p><strong>Note:</strong> For this recipe you need ArangoDB 2.4. For ArangoDB since 2.5 look at the <a href="FoxxAuth.html">new Foxx Authentcation</a>.</p>
<h2 id="solution">Solution</h2>
<p>In order to introduce authentication to the todo app we <a href="FoxxFirstSteps.html">built</a>, we first need to create a route to register users. In order to do that, we first introduce a new Foxx.Model <em>Credentials</em> with <code>username</code> and <code>password</code>:</p>
<pre><code class="lang-js"><span class="hljs-keyword">var</span> Foxx = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;org/arangodb/foxx&apos;</span>),
  Joi = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;joi&apos;</span>),
  Credentials;

Credentials = Foxx.Model.extend({
  schema: {
    username: Joi.string().required(),
    password: Joi.string().required()
  }
});

exports.Credentials = Credentials;
</code></pre>
<p>In our controller we first require it via <code>Credentials = require(&apos;models/credentials&apos;).Credentials</code>, then we create a new route to register people. Let&apos;s first see that we get all information we require by giving back the username and password. We also set the status code to be a 201 as we will create a new resource.</p>
<pre><code class="lang-js"><span class="hljs-comment">/** Register a new user
 *
 * Add a new user to the system with a given username and password
 */</span>
controller.post(<span class="hljs-string">&apos;/register&apos;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">req, res</span>) </span>{
  <span class="hljs-keyword">var</span> credentials = req.params(<span class="hljs-string">&apos;credentials&apos;</span>),
    username = credentials.get(<span class="hljs-string">&apos;username&apos;</span>),
    password = credentials.get(<span class="hljs-string">&apos;password&apos;</span>);

  res.status(<span class="hljs-number">201</span>);
  res.json({
    username: username,
    password: password
  });
}).bodyParam(<span class="hljs-string">&apos;credentials&apos;</span>, <span class="hljs-string">&apos;Username and Password&apos;</span>, Credentials);
</code></pre>
<p>Now we need to have a place to store users. In order to do that, we will use the functionality of two other foxx applications by first requiring them and then injecting them. We&apos;re injecting the exported APIs of the built-in user and auth apps into our controller (we will see what that means in a minute). Like the built-in sessions app, a copy of the user and auth apps are automatically mounted at these mount points by ArangoDB. So all we do in our controller is the following:</p>
<pre><code class="lang-js">controller.addInjector({
  auth: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{ <span class="hljs-keyword">return</span> Foxx.requireApp(<span class="hljs-string">&apos;/_system/simple-auth&apos;</span>).auth; },
  users: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{ <span class="hljs-keyword">return</span> Foxx.requireApp(<span class="hljs-string">&apos;/_system/users&apos;</span>).userStorage; }
});
</code></pre>
<p>As a result of that our actions now get a third parameter which is an object with the objects we injected -- in our case <code>auth</code> and <code>users</code>. Let&apos;s use the authentication app to hash and salt our password:</p>
<pre><code class="lang-js">controller.post(<span class="hljs-string">&apos;/register&apos;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">req, res, injected</span>) </span>{
  <span class="hljs-keyword">var</span> credentials = req.params(<span class="hljs-string">&apos;credentials&apos;</span>),
    username = credentials.get(<span class="hljs-string">&apos;username&apos;</span>),
    password = injected.auth.hashPassword(credentials.get(<span class="hljs-string">&apos;password&apos;</span>));

  res.status(<span class="hljs-number">201</span>);
  res.json({
    username: username,
    password: password
  });
}).bodyParam(<span class="hljs-string">&apos;credentials&apos;</span>, <span class="hljs-string">&apos;Username and Password&apos;</span>, Credentials);
</code></pre>
<p>Great! Now let&apos;s use our users app to store a new user. The injected <code>users</code> object has a create method which takes three arguments: The username, a user profile (which we will leave empty for now) and a password object. Let&apos;s create a user:</p>
<pre><code class="lang-js">controller.post(<span class="hljs-string">&apos;/register&apos;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">req, res, injected</span>) </span>{
  <span class="hljs-keyword">var</span> credentials = req.params(<span class="hljs-string">&apos;credentials&apos;</span>),
    username = credentials.get(<span class="hljs-string">&apos;username&apos;</span>),
    password = injected.auth.hashPassword(credentials.get(<span class="hljs-string">&apos;password&apos;</span>)),
    user;

  user = injected.users.create(username, {}, { simple: password });

  res.status(<span class="hljs-number">201</span>);
  res.json({
    username: username
  });
}).bodyParam(<span class="hljs-string">&apos;credentials&apos;</span>, <span class="hljs-string">&apos;Username and Password&apos;</span>, Credentials);
</code></pre>
<p>Now create a user with username and password via the route. To see the created user, we will look into the user collection of ArangoDB. First, go to the collections tab. It is a system collection, so we first need to show system collections by clicking on the cogwheel and activating system collections. Then click on the collection users and you will see your new users. Great!</p>
<p>Now let&apos;s clean this up a little. We want to have a repository-like structure that will create users for us and do hashing etc. As this requires the two other applications, we have to inject it. Let&apos;s create an <code>injectors</code> folder and create a <code>users.js</code> file there:</p>
<pre><code class="lang-js"><span class="hljs-keyword">var</span> _ = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;underscore&apos;</span>),
  Foxx = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;org/arangodb/foxx&apos;</span>),
  UsersRepository,
  injectUsers;

UsersRepository = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">this</span>.auth = Foxx.requireApp(<span class="hljs-string">&apos;/_system/simple-auth&apos;</span>).auth;
  <span class="hljs-keyword">this</span>.users = Foxx.requireApp(<span class="hljs-string">&apos;/_system/users&apos;</span>).userStorage;
};

_.extend(UsersRepository.prototype, {
  create: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">credentials</span>) </span>{
    <span class="hljs-keyword">var</span> password = <span class="hljs-keyword">this</span>.auth.hashPassword(credentials.get(<span class="hljs-string">&apos;password&apos;</span>));
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.users.create(credentials.get(<span class="hljs-string">&apos;username&apos;</span>), {}, { simple: password });
  }
});

injectUsers = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">var</span> usersRepository = <span class="hljs-keyword">new</span> UsersRepository();
  <span class="hljs-keyword">return</span> usersRepository;
};

exports.injectUsers = injectUsers;
</code></pre>
<p>This will export an injector function, that we can now use instead of the other two injections:</p>
<pre><code class="lang-js">controller.addInjector({
  users: injectUsers
});
</code></pre>
<p>And now we can simplify our controller:</p>
<pre><code class="lang-js">controller.post(<span class="hljs-string">&apos;/register&apos;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">req, res, injected</span>) </span>{
  <span class="hljs-keyword">var</span> credentials = req.params(<span class="hljs-string">&apos;credentials&apos;</span>),
    user = injected.users.create(credentials);

  res.status(<span class="hljs-number">201</span>);
  res.json({
    username: user.get(<span class="hljs-string">&apos;user&apos;</span>)
  });
}).bodyParam(<span class="hljs-string">&apos;credentials&apos;</span>, <span class="hljs-string">&apos;Username and Password&apos;</span>, Credentials);
</code></pre>
<p>We now have a dedicated place to handle creating and searching for users. It is also a good place for raising exceptions if something goes wrong -- for example if the user is not found. In that case we would catch the exception from the module and translate it into our own, application specific error that we can then add as an errorReponse to the routes in our FoxxController. It is also a good place to put our code to find a user by his or her credentials. But first we need to activate sessions for this controller (in your app, the cookie secret should be something app-specific, <strong>really secret</strong>):</p>
<pre><code class="lang-js">controller.activateSessions({
  type: <span class="hljs-string">&apos;cookie&apos;</span>,
  cookie: {
    secret: <span class="hljs-string">&apos;secret&apos;</span>
  }
});
</code></pre>
<p>Now we can add another method to our injector to log in a user. It will take the provided credentials and the session. It will throw an error when the credentials are not valid (you can create a file <code>not_logged_in.js</code> in an <code>error</code> folder and require it from both here and the controller) -- otherwise it will set the session data and return the user.</p>
<pre><code class="lang-js">login: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">credentials, session</span>) </span>{
  <span class="hljs-keyword">var</span> user = <span class="hljs-keyword">this</span>.users.resolve(credentials.get(<span class="hljs-string">&apos;username&apos;</span>));
  <span class="hljs-keyword">var</span> valid = <span class="hljs-keyword">this</span>.auth.verifyPassword(
    user ? user.get(<span class="hljs-string">&apos;authData&apos;</span>).simple : {},
    credentials.get(<span class="hljs-string">&apos;password&apos;</span>)
  );

  <span class="hljs-keyword">if</span> (!valid) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NotLoggedIn();
  }

  session.get(<span class="hljs-string">&apos;sessionData&apos;</span>).username = user.get(<span class="hljs-string">&apos;user&apos;</span>);
  session.setUser(user);
  session.save();
  <span class="hljs-keyword">return</span> user;
}
</code></pre>
<p>Let&apos;s use this in a new login route:</p>
<pre><code class="lang-js">controller.post(<span class="hljs-string">&apos;/login&apos;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">req, res, injected</span>) </span>{
  <span class="hljs-keyword">var</span> credentials = req.params(<span class="hljs-string">&apos;credentials&apos;</span>),
    user = injected.users.login(credentials, req.session);

  res.status(<span class="hljs-number">201</span>);
  res.json({
    msg: <span class="hljs-string">&apos;Welcome &apos;</span> + user.get(<span class="hljs-string">&apos;user&apos;</span>)
  });
}).bodyParam(<span class="hljs-string">&apos;credentials&apos;</span>, <span class="hljs-string">&apos;Username and Password&apos;</span>, Credentials)
  .errorResponse(NotLoggedIn, <span class="hljs-number">401</span>, <span class="hljs-string">&apos;Login failed&apos;</span>);
</code></pre>
<p>And a logout route like that:</p>
<pre><code class="lang-js">controller.destroySession(<span class="hljs-string">&apos;/logout&apos;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">req, res</span>) </span>{
  res.json({success: <span class="hljs-literal">true</span>});
});
</code></pre>
<p>And now we have authentication and registration set up. We can now restrict access to logged in users only in any of our routes with <code>.onlyIfAuthenticated();</code> and do more complex things by accessing the session in an <code>onlyIf</code> call. Let&apos;s restrict the access to the list of todos to logged in users:</p>
<pre><code class="lang-js">controller.get(<span class="hljs-string">&apos;/&apos;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">req, res</span>) </span>{
  res.json(_.map(todos.all(), <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">todo</span>) </span>{
    <span class="hljs-keyword">return</span> todo.forClient();
  }));
}).onlyIfAuthenticated();
</code></pre>
<p><strong>Author</strong>: <a href="https://github.com/moonglum" target="_blank">Lucas Dohmen</a></p>
<p><strong>Tags</strong>: #foxx</p>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="./FoxxAuth.html" class="navigation navigation-prev " aria-label="Previous page: Adding Authentication"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="./MakingRequests.html" class="navigation navigation-next " aria-label="Next page: Using external APIs"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="gitbook/app.js"></script>

    
    <script src="gitbook/plugins/gitbook-plugin-piwik/plugin.js"></script>
    

    
    <script src="gitbook/plugins/gitbook-plugin-search/lunr.min.js"></script>
    

    
    <script src="gitbook/plugins/gitbook-plugin-search/search.js"></script>
    

    
    <script src="gitbook/plugins/gitbook-plugin-sharing/buttons.js"></script>
    

    
    <script src="gitbook/plugins/gitbook-plugin-fontsettings/buttons.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"piwik":{"URL":"www.arangodb.com/piwik/","siteId":12},"addcssjs":{"js":["styles/header.js"],"css":["styles/header.css"]},"highlight":{},"search":{},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2}};
    gitbook.start(config);
});
</script>

        <script type="text/javascript">var _paq = _paq || [];_paq.push(['trackPageView']);_paq.push(['enableLinkTracking']);(function() {var u=(("https:" == document.location.protocol) ? "https" : "http") + "://www.arangodb.com/piwik/";_paq.push(['setTrackerUrl', u+'piwik.php']);_paq.push(['setSiteId', 12]);var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0]; g.type='text/javascript';g.defer=true; g.async=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);})();</script><noscript><p><img src="http://www.arangodb.com/piwik/piwik.php?idsite=12" style="border:0;" alt="" /></p></noscript>
    </body>
    
</html>
