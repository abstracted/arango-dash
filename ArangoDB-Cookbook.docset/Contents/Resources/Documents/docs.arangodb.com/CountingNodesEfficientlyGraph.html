<!DOCTYPE HTML>
<html lang="en" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>Counting Nodes efficiently | Cookbook</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.5.2">
        
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">
        
    <link rel="stylesheet" href="gitbook/style.css">
    
        
        <link rel="stylesheet" href="gitbook/plugins/gitbook-plugin-highlight/website.css">
        
    
        
        <link rel="stylesheet" href="gitbook/plugins/gitbook-plugin-search/search.css">
        
    
        
        <link rel="stylesheet" href="gitbook/plugins/gitbook-plugin-fontsettings/website.css">
        
    
    
        <link rel="stylesheet" href="./styles/website.css">
    

        
    
    
    <link rel="next" href="./CreatingTestDataAQL.html" />
    
    
    <link rel="prev" href="./FilteringNodesGraph.html" />
    

        <script type="text/javascript" src="styles/header.js"></script><link rel="stylesheet" type="text/css" href="styles/header.css">
    </head>
    <body>
        
        
    <div class="book" data-level="3.5" data-chapter-title="Counting Nodes efficiently" data-filepath="CountingNodesEfficientlyGraph.md" data-basepath="." data-revision="Tue Jan 19 2016 13:30:25 GMT+0100 (CET)">
    

<div class="book-summary">
    <nav role="navigation">
        <ul class="summary">
            
            
            
            

            

            
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="./index.html">
                
                        <i class="fa fa-check"></i>
                        
                        Introduction
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1" data-path="ModulDocumentInheritance.html">
            
                
                    <a href="./ModulDocumentInheritance.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                        Modelling Document Inheritance
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2" data-path="AccessingShapesData.html">
            
                
                    <a href="./AccessingShapesData.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                        Accessing Shapes Data
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3" >
            
            <span><b>3.</b> AQL</span>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1" data-path="JoinsInAQL.html">
            
                
                    <a href="./JoinsInAQL.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.</b>
                        
                        Using Joins in AQL
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="UsingDynamicAttributeNames.html">
            
                
                    <a href="./UsingDynamicAttributeNames.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.2.</b>
                        
                        Using Dynamic Attribute Names
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="FindingLeafNodesGraph.html">
            
                
                    <a href="./FindingLeafNodesGraph.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.3.</b>
                        
                        Finding Leaf Nodes in a Graph
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.4" data-path="FilteringNodesGraph.html">
            
                
                    <a href="./FilteringNodesGraph.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.4.</b>
                        
                        Filtering Nodes in a Graph
                    </a>
            
            
        </li>
    
        <li class="chapter active" data-level="3.5" data-path="CountingNodesEfficientlyGraph.html">
            
                
                    <a href="./CountingNodesEfficientlyGraph.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.5.</b>
                        
                        Counting Nodes efficiently
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.6" data-path="CreatingTestDataAQL.html">
            
                
                    <a href="./CreatingTestDataAQL.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.6.</b>
                        
                        Creating Test-data using AQL
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.7" data-path="DiffingDocuments.html">
            
                
                    <a href="./DiffingDocuments.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.7.</b>
                        
                        Diffing Documents
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.8" data-path="AvoidingInjection.html">
            
                
                    <a href="./AvoidingInjection.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.8.</b>
                        
                        Avoiding Parameter Injection
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.9" data-path="MultilineQueryStrings.html">
            
                
                    <a href="./MultilineQueryStrings.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.9.</b>
                        
                        Multiline Query Strings
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4" >
            
            <span><b>4.</b> Graph-based Recipes</span>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1" data-path="Fulldepth.html">
            
                
                    <a href="./Fulldepth.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.1.</b>
                        
                        Fulldepth Graph-Traversal
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.2" data-path="FindingConnectedVerticesForSubgraphs.html">
            
                
                    <a href="./FindingConnectedVerticesForSubgraphs.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.2.</b>
                        
                        Vertices for Subgraphs
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.3" data-path="JavaDriverGraphExampleVertex.html">
            
                
                    <a href="./JavaDriverGraphExampleVertex.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.3.</b>
                        
                        Vertex example with Java
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.4" data-path="JavaDriverBaseDocument.html">
            
                
                    <a href="./JavaDriverBaseDocument.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.4.</b>
                        
                        Accessing base documents with Java
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.5" data-path="UsingCustomVisitorFromNodeJs.html">
            
                
                    <a href="./UsingCustomVisitorFromNodeJs.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.5.</b>
                        
                        Using a custom Visitor
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.6" data-path="GraphExampleActorsAndMovies.html">
            
                
                    <a href="./GraphExampleActorsAndMovies.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.6.</b>
                        
                        Example AQL Queries for Graphs
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5" >
            
            <span><b>5.</b> Foxx Framework</span>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1" data-path="FoxxFirstSteps.html">
            
                
                    <a href="./FoxxFirstSteps.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.1.</b>
                        
                        My first Foxx App
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.2" data-path="FoxxFirstStepsLegacy.html">
            
                
                    <a href="./FoxxFirstStepsLegacy.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.2.</b>
                        
                        My first Foxx App pre-2.4
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.3" data-path="FoxxAuth.html">
            
                
                    <a href="./FoxxAuth.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.3.</b>
                        
                        Adding Authentication
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.4" data-path="FoxxAuthLegacy.html">
            
                
                    <a href="./FoxxAuthLegacy.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.4.</b>
                        
                        Adding Authentication pre-2.5
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.5" data-path="MakingRequests.html">
            
                
                    <a href="./MakingRequests.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.5.</b>
                        
                        Using external APIs
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.6" data-path="FoxxQueues.html">
            
                
                    <a href="./FoxxQueues.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.6.</b>
                        
                        Background jobs
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.7" data-path="FoxxQueuesLegacy.html">
            
                
                    <a href="./FoxxQueuesLegacy.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.7.</b>
                        
                        legacy background jobs
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.8" data-path="FoxxCustomQueueJobsLegacy.html">
            
                
                    <a href="./FoxxCustomQueueJobsLegacy.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.8.</b>
                        
                        legacy custom Background jobs
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.9" data-path="FoxxScripts.html">
            
                
                    <a href="./FoxxScripts.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.9.</b>
                        
                        Creating a Foxx script
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.10" data-path="FoxxCustomQueueJobs.html">
            
                
                    <a href="./FoxxCustomQueueJobs.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.10.</b>
                        
                        Custom job types for Queues
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.11" data-path="FoxxGeneratorFirstSteps.html">
            
                
                    <a href="./FoxxGeneratorFirstSteps.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.11.</b>
                        
                        My first FoxxGenerator App
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.12" data-path="FoxxDeploy.html">
            
                
                    <a href="./FoxxDeploy.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.12.</b>
                        
                        How to deploy a Foxx App
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.13" data-path="MakingFoxxAppAccessible.html">
            
                
                    <a href="./MakingFoxxAppAccessible.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.13.</b>
                        
                        Apps accessible from the Web
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.14" data-path="FoxxApiKeys.html">
            
                
                    <a href="./FoxxApiKeys.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.14.</b>
                        
                        API-Key Management
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.15" data-path="FoxxBinaryHttpPost.html">
            
                
                    <a href="./FoxxBinaryHttpPost.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.15.</b>
                        
                        Binary HTTP documents
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.16" data-path="FoxxTesting.html">
            
                
                    <a href="./FoxxTesting.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.16.</b>
                        
                        Foxx Testing
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="6" >
            
            <span><b>6.</b> Use Cases, Examples</span>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="6.1" data-path="CrawlingGithubPromises.html">
            
                
                    <a href="./CrawlingGithubPromises.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.1.</b>
                        
                        Crawling Github with Promises
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.2" data-path="UsingArangoDBWithSailsJS.html">
            
                
                    <a href="./UsingArangoDBWithSailsJS.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.2.</b>
                        
                        Using ArangoDB with Sails.js
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.3" data-path="PopulatingAnAutocompleteTextbox.html">
            
                
                    <a href="./PopulatingAnAutocompleteTextbox.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.3.</b>
                        
                        Populating a Textbox
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.4" data-path="ExportingData.html">
            
                
                    <a href="./ExportingData.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.4.</b>
                        
                        Exporting Data
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="7" >
            
            <span><b>7.</b> ArangoDB Setup / Administration</span>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="7.1" data-path="UsingAuthentication.html">
            
                
                    <a href="./UsingAuthentication.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.1.</b>
                        
                        Using Authentication
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="7.2" data-path="ImportingData.html">
            
                
                    <a href="./ImportingData.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.2.</b>
                        
                        Importing Data
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="7.3" data-path="ReplicatingData.html">
            
                
                    <a href="./ReplicatingData.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.3.</b>
                        
                        Replicating Data
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="7.4" data-path="XCopyInstallWindows.html">
            
                
                    <a href="./XCopyInstallWindows.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.4.</b>
                        
                        XCopy Install Windows
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="7.5" data-path="Compiling.html">
            
                
                    <a href="./Compiling.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.5.</b>
                        
                        Compiling / Build
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="7.5.1" data-path="CompilingOnDebian.html">
            
                
                    <a href="./CompilingOnDebian.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.5.1.</b>
                        
                        Compile on Debian
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="7.5.2" data-path="CompilingUnderWindows.html">
            
                
                    <a href="./CompilingUnderWindows.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.5.2.</b>
                        
                        Compile on Windows
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="7.5.3" data-path="CompilingUnderWindowsLegacy.html">
            
                
                    <a href="./CompilingUnderWindowsLegacy.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.5.3.</b>
                        
                        Compile on Windows pre-2.4
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="7.5.4" data-path="RunningCustomBuild.html">
            
                
                    <a href="./RunningCustomBuild.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.5.4.</b>
                        
                        Running Custom Build
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="8" >
            
            <span><b>8.</b> Cloud, DCOS and Docker</span>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="8.1" data-path="RunningOnAWS.html">
            
                
                    <a href="./RunningOnAWS.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.1.</b>
                        
                        Running on AWS
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.2" data-path="UpdateArangoDBOnAWS.html">
            
                
                    <a href="./UpdateArangoDBOnAWS.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.2.</b>
                        
                        Update on AWS
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.3" data-path="UsingArangoDBAzure.html">
            
                
                    <a href="./UsingArangoDBAzure.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.3.</b>
                        
                        Running on Azure
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.4" data-path="RunningInDockerContainer.html">
            
                
                    <a href="./RunningInDockerContainer.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.4.</b>
                        
                        Docker ArangoDB
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.5" data-path="UsingArangoDBNodeJSDocker.html">
            
                
                    <a href="./UsingArangoDBNodeJSDocker.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.5.</b>
                        
                        Docker with NodeJS App
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.6" data-path="UsingArangoDBInGiantSwarm.html">
            
                
                    <a href="./UsingArangoDBInGiantSwarm.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.6.</b>
                        
                        In the GiantSwarm
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.7" data-path="UsingArangoDBMesosphere.html">
            
                
                    <a href="./UsingArangoDBMesosphere.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.7.</b>
                        
                        ArangoDB in Mesos
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="9" >
            
            <span><b>9.</b> Monitoring</span>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="9.1" data-path="MonitoringWithCollectd.html">
            
                
                    <a href="./MonitoringWithCollectd.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.1.</b>
                        
                        Monitoring with Collectd
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="9.2" data-path="MonitoringSlaveStatus.html">
            
                
                    <a href="./MonitoringSlaveStatus.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.2.</b>
                        
                        Collectd - Replication Slaves
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="9.3" data-path="MonitoringTrafficWithIPAccounting.html">
            
                
                    <a href="./MonitoringTrafficWithIPAccounting.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.3.</b>
                        
                        Collectd - Network usage
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="9.4" data-path="MonitoringOtherRelevantMetrics.html">
            
                
                    <a href="./MonitoringOtherRelevantMetrics.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.4.</b>
                        
                        Collectd - more Metrics
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="9.5" data-path="MonitoringFoxxApps.html">
            
                
                    <a href="./MonitoringFoxxApps.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.5.</b>
                        
                        Collectd - Monitoring Foxx
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    


            
            <li class="divider"></li>
            <li>
                <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                    Published with GitBook
                </a>
            </li>
            
        </ul>
    </nav>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header" role="navigation">
    <!-- Actions Left -->
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="./" >Cookbook</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1" role="main">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <h1 id="efficiently-counting-nodes-in-a-graph-using-aql">Efficiently counting nodes in a graph using AQL</h1>
<h2 id="problem">Problem</h2>
<p>I want to efficiently count the number of nodes in a graph that satisfy some filter
criteria with AQL.</p>
<h2 id="solution">Solution</h2>
<p>Use a traversal with a custom visitor function. This is available since ArangoDB 2.4.2.
A custom visitor function is user-defined function that is called for every node that
is visited during the traversal. It can append values to the traversal result.</p>
<p>Why do we need a custom visitor function for such a simple task as counting nodes?
The main reason is efficiency. The general traversal framework is very versatile and
can be used for different tasks. By default, it will copy the vertex data and the full
path information for each visited vertex into the result. This can easily get very big
for bigger graphs.</p>
<p>If all we want is to count nodes, we can be much more efficient by employing a custom
visitor function.</p>
<h3 id="registering-a-custom-counter-function">Registering a custom counter function</h3>
<p>User-defined visitor functions are written in JavaScript. Once a function is written,
it needs to be registered on the server to become usable from inside an AQL query.</p>
<p>The following snippet, to be executed in the ArangoShell, registers a custom visitor 
function that counts the number of nodes visited during a traversal:</p>
<pre><code class="lang-js"><span class="hljs-keyword">var</span> aqlfunctions = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;org/arangodb/aql/functions&quot;</span>);

aqlfunctions.register(<span class="hljs-string">&quot;myfunctions::vertexCounter&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">config, result</span>) </span>{
  <span class="hljs-keyword">if</span> (result.length === <span class="hljs-number">0</span>) {
    result.push(<span class="hljs-number">0</span>);
  }
  result[<span class="hljs-number">0</span>]++;
});
</code></pre>
<p>The above registered the custom visitor under the name <code>myfunctions::vertexCounter</code>. It
can now be used from an AQL query that contains a traversal. </p>
<h3 id="example-data-setup">Example data setup</h3>
<p>We also need some data to run a query against. I suggest using the example graph and data 
from <a href="https://jsteemann.github.io/downloads/code/world-graph-setup.js" target="_blank">here</a>.
Please download the code from the link and store it in the filesystem using a filename
of <code>world-graph-setup.js</code>. Then start the ArangoShell and run the code from the file:</p>
<pre><code class="lang-js"><span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;internal&quot;</span>).load(<span class="hljs-string">&quot;/path/to/file/world-graph-setup.js&quot;</span>);
</code></pre>
<p>This should have made available two collections <code>v</code> and <code>e</code>, which we can use as a graph.</p>
<h3 id="invoking-the-counter-function-from-aql">Invoking the counter function from AQL</h3>
<p>All that&apos;s missing now is a query that invokes the custom counting function on the data.
Here it is:</p>
<pre><code>LET params = { 
  visitor : &quot;myfunctions::vertexCounter&quot;, 
  visitorReturnsResults : false 
}
FOR result IN TRAVERSAL(v, e, &quot;v/world&quot;, &quot;inbound&quot;, params) 
  RETURN result
</code></pre><p>You can run the above query from the <strong>AQL editor</strong> in the web interface. It should only
produce a single value indicating the number of nodes visited during the traversal.</p>
<h3 id="remarks">Remarks</h3>
<p>Please note the following things:</p>
<ul>
<li><p>the AQL query will use two collections as in the example graph. They are named <code>v</code> and 
<code>e</code>. The vertices are connected via inbound edges. The traversal will start at the
node with id <code>v/world</code> as specified. To use other collections, a different start vertex
or outbound connections, please adjust the <code>TRAVERSAL(...)</code> call.</p>
</li>
<li><p>the visitor function name (<code>visitor</code> attribute of the configuration) in the example
is <code>myfunctions::vertexCounter</code>. Adjust as required!</p>
</li>
<li><p>the <code>visitorReturnsResults</code> attribute was set to <code>false</code>. This means that the return
value of the custom visitor function will be ignored. Instead, it can modify the traversal
result in place. The previous result is handed to the custom visitor as the second 
function call parameter (<code>result</code>). On the first call, result will be an empty array as
nothing was produced yet. In this case the function pushes a start value of 0 into the 
result. Afterwards, and an all further invocations, the visitor will increment the 
array value at position 0 by 1.</p>
</li>
<li><p>the solution using the custom visitor will be much faster than when using the default 
visitor to return all matching nodes and counting them later. The advantage of the
custom visitor counter will be more measurable the more vertices are visited and the
more data they contain. </p>
</li>
</ul>
<h3 id="further-uses">Further uses</h3>
<p>The above example is using the AQL function <code>TRAVERSAL()</code>, which requires a vertex and 
an edge collection to be specified. Custom visitors can also be used in the
<code>GRAPH_TRAVERSAL()</code> AQL function, which does not require named collections but a named 
graph. To make the above query work on a graph <code>WorldGraph</code> and use <code>GRAPH_TRAVERSAL()</code>
instead of <code>TRAVERSAL()</code>, change the query to:</p>
<pre><code>LET params = { 
  visitor : &quot;myfunctions::vertexCounter&quot;, 
  visitorReturnsResults : false 
}
FOR result IN GRAPH_TRAVERSAL(&quot;WorldGraph&quot;, &quot;v/world&quot;, &quot;inbound&quot;, params) 
  RETURN result
</code></pre><p>In order to produce not only a single result value but counting vertices by other criteria,
use an object to hold multiple counter values.</p>
<p>The following counter function (also named <code>myfunctions::vertexCounter</code>) counts the number
of vertices visited grouped by the value of their <code>type</code> attributes:</p>
<pre><code class="lang-js"><span class="hljs-keyword">var</span> aqlfunctions = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;org/arangodb/aql/functions&quot;</span>);

aqlfunctions.register(<span class="hljs-string">&quot;myfunctions::vertexCounter&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">config, result, vertex</span>) </span>{
  <span class="hljs-keyword">if</span> (result.length === <span class="hljs-number">0</span>) {
    result.push({ });
  }
  <span class="hljs-keyword">var</span> vertexType = vertex.type;
  <span class="hljs-keyword">if</span> (! result[<span class="hljs-number">0</span>].hasOwnProperty(vertexType)) {
    result[<span class="hljs-number">0</span>][vertexType] = <span class="hljs-number">1</span>;
  }
  <span class="hljs-keyword">else</span> {
    result[<span class="hljs-number">0</span>][vertexType]++;
  }
});
</code></pre>
<p>You can use the same AQL query as above to run the query.</p>
<p>Custom visitors such as the counter function in this example can be combined with custom 
filter functions, too. This allows restricting results to only certain types of vertices, 
or following only specific edges/connections/paths in the graph.</p>
<p><strong>Author:</strong> <a href="https://github.com/jsteemann" target="_blank">Jan Steemann</a></p>
<p><strong>Tags</strong>: #graph #traversal #aql</p>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="./FilteringNodesGraph.html" class="navigation navigation-prev " aria-label="Previous page: Filtering Nodes in a Graph"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="./CreatingTestDataAQL.html" class="navigation navigation-next " aria-label="Next page: Creating Test-data using AQL"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="gitbook/app.js"></script>

    
    <script src="gitbook/plugins/gitbook-plugin-piwik/plugin.js"></script>
    

    
    <script src="gitbook/plugins/gitbook-plugin-search/lunr.min.js"></script>
    

    
    <script src="gitbook/plugins/gitbook-plugin-search/search.js"></script>
    

    
    <script src="gitbook/plugins/gitbook-plugin-sharing/buttons.js"></script>
    

    
    <script src="gitbook/plugins/gitbook-plugin-fontsettings/buttons.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"piwik":{"URL":"www.arangodb.com/piwik/","siteId":12},"addcssjs":{"js":["styles/header.js"],"css":["styles/header.css"]},"highlight":{},"search":{},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2}};
    gitbook.start(config);
});
</script>

        <script type="text/javascript">var _paq = _paq || [];_paq.push(['trackPageView']);_paq.push(['enableLinkTracking']);(function() {var u=(("https:" == document.location.protocol) ? "https" : "http") + "://www.arangodb.com/piwik/";_paq.push(['setTrackerUrl', u+'piwik.php']);_paq.push(['setSiteId', 12]);var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0]; g.type='text/javascript';g.defer=true; g.async=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);})();</script><noscript><p><img src="http://www.arangodb.com/piwik/piwik.php?idsite=12" style="border:0;" alt="" /></p></noscript>
    </body>
    
</html>
